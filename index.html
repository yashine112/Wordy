<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wordy</title>
  <meta name="theme-color" content="#111827" />
  <link rel="manifest" href="manifest.json" />

  <!-- Kinderfreundliche Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700;800&family=Nunito:wght@700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#0F172A;
      --muted:#64748B;
      --stroke: rgba(15,23,42,.10);
      --glass: rgba(255,255,255,.78);
      --shadow: 0 18px 50px rgba(15,23,42,.14);
      --shadow2: 0 10px 24px rgba(15,23,42,.10);
      --ring: 0 0 0 4px rgba(124,58,237,.18);

      --p1:#8B5CF6; /* purple */
      --p2:#EC4899; /* pink */
      --c1:#06B6D4; /* cyan */
      --m1:#22C55E; /* mint */
      --g1:#16A34A; /* green */
      --r1:#EF4444; /* red */
      --d1:#111827; /* dark */
    }

    *{ box-sizing:border-box; }

    body{
      margin:0;
      font-family: "Nunito", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1100px 700px at 15% 10%, #FFE3F1 0%, transparent 55%),
        radial-gradient(950px 700px at 85% 25%, #D8F5FF 0%, transparent 58%),
        radial-gradient(900px 700px at 55% 95%, #E8FFE7 0%, transparent 55%),
        linear-gradient(180deg, #FFF7FB, #F2FBFF);
      min-height:100vh;
      overflow-x:hidden;
      position:relative;
    }

    /* bunte Punkte im Hintergrund */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      background-image:
        radial-gradient(circle at 10% 20%, rgba(236,72,153,.20) 0 3px, transparent 4px),
        radial-gradient(circle at 80% 15%, rgba(139,92,246,.18) 0 3px, transparent 4px),
        radial-gradient(circle at 60% 80%, rgba(34,197,94,.18) 0 3px, transparent 4px),
        radial-gradient(circle at 20% 75%, rgba(6,182,212,.18) 0 3px, transparent 4px),
        radial-gradient(circle at 35% 45%, rgba(245,158,11,.16) 0 3px, transparent 4px),
        radial-gradient(circle at 92% 55%, rgba(99,102,241,.16) 0 3px, transparent 4px);
      background-repeat:no-repeat;
      opacity:.9;
    }

    .wrap{
      max-width:640px;
      margin:0 auto;
      padding:20px 16px 34px;
      position:relative;
    }

    .brand{
      text-align:center;
      margin: 6px 0 12px;
    }
    .brand h1{
      margin:0;
      font-family: "Baloo 2", "Nunito", system-ui, sans-serif;
      font-size:56px;
      line-height:1.0;
      letter-spacing:-.6px;
      font-weight:800;
      background: linear-gradient(135deg, var(--p1), var(--p2), var(--c1));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      text-shadow: 0 10px 26px rgba(124,58,237,.12);
    }
    .brand p{
      margin:10px 0 0;
      font-size:14px;
      color:var(--muted);
      font-weight:900;
    }

    .card{
      background: var(--glass);
      border: 2px solid rgba(255,255,255,.8);
      box-shadow: var(--shadow);
      border-radius: 30px;
      padding: 16px;
      backdrop-filter: blur(14px);
      position:relative;
      overflow:hidden;
    }
    .card::before, .card::after{
      content:"";
      position:absolute;
      width:180px; height:180px;
      border-radius: 36px;
      opacity:.25;
      pointer-events:none;
    }
    .card::before{
      right:-70px; top:-70px;
      background: radial-gradient(circle at 30% 30%, rgba(236,72,153,.65), rgba(139,92,246,.35), transparent 60%);
      transform: rotate(10deg);
    }
    .card::after{
      left:-80px; bottom:-80px;
      background: radial-gradient(circle at 40% 40%, rgba(34,197,94,.60), rgba(6,182,212,.35), transparent 60%);
      transform: rotate(-12deg);
    }

    .panel{
      background: rgba(255,255,255,.80);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow2);
      border-radius: 22px;
      padding: 14px;
    }

    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:2px 0 8px;
      text-align:left;
      font-weight:1000;
      letter-spacing:.3px;
      text-transform: uppercase;
    }

    input, select, button{
      width:100%;
      font-size:16px;
      border-radius:18px;
      padding:14px 14px;
      font-family: "Nunito", system-ui, sans-serif;
    }

    input, select{
      background:#fff;
      color:var(--ink);
      border:2px solid rgba(15,23,42,.08);
      outline:none;
      box-shadow: 0 8px 18px rgba(15,23,42,.06);
    }
    input:focus, select:focus{ box-shadow: var(--ring); border-color: rgba(124,58,237,.35); }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:12px;
    }

    button{
      border:none;
      cursor:pointer;
      font-weight:1000;
      letter-spacing:.2px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      box-shadow: 0 14px 22px rgba(15,23,42,.14);
      transition: transform .08s ease, filter .15s ease;
      position:relative;
      overflow:hidden;
    }
    button:active{ transform: translateY(1px); }
    button:disabled{ opacity:.55; cursor:not-allowed; filter:saturate(.6); }

    button::after{
      content:"";
      position:absolute;
      inset:-40% -20% auto -20%;
      height:120%;
      background: linear-gradient(120deg, rgba(255,255,255,.0), rgba(255,255,255,.35), rgba(255,255,255,.0));
      transform: rotate(10deg);
      opacity:.6;
      pointer-events:none;
    }

    .btnPrimary{ background: linear-gradient(135deg, var(--p1), var(--p2)); color:white; }
    .btnDark{ background: linear-gradient(135deg, #111827, #334155); color:white; }
    .btnGood{ background: linear-gradient(135deg, #16A34A, #22C55E); color:white; }
    .btnBad{ background: linear-gradient(135deg, #EF4444, #F97316); color:white; }
    .btnWord{ background: linear-gradient(135deg, #06B6D4, #22C55E); color:white; }

    .bigTurn{
      margin-top:14px;
      border-radius: 26px;
      padding: 14px;
      background: rgba(255,255,255,.92);
      border: 3px solid rgba(124,58,237,.18);
      box-shadow: 0 18px 30px rgba(15,23,42,.12);
      text-align:center;
    }
    .bigTurn .small{
      font-size:12px;
      color:var(--muted);
      font-weight:1000;
      text-transform:uppercase;
      letter-spacing:.25px;
      margin-bottom:6px;
    }
    .bigTurn .name{
      font-family:"Baloo 2","Nunito",system-ui,sans-serif;
      font-size:34px;
      font-weight:800;
      line-height:1.05;
    }
    .bigTurn .badge{
      display:inline-block;
      margin-top:8px;
      padding:6px 12px;
      border-radius:999px;
      font-size:12px;
      font-weight:1000;
      color:#5B21B6;
      background: rgba(124,58,237,.12);
      border:2px solid rgba(124,58,237,.22);
    }

    .wordCard{
      margin-top:14px;
      border-radius:28px;
      padding:18px 16px;
      background: rgba(255,255,255,.95);
      border: 2px dashed rgba(124,58,237,.28);
      box-shadow: 0 18px 34px rgba(15,23,42,.12);
      text-align:center;
      min-height: 150px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:10px;
    }

    .word{
      font-family: "Baloo 2", "Nunito", system-ui, sans-serif;
      font-size:46px;
      font-weight:800;
      letter-spacing:-.4px;
      line-height:1.05;
      padding: 4px 6px;
      will-change: transform, opacity;
    }

    .wordHint{
      font-size:13px;
      color:var(--muted);
      font-weight:1000;
    }

    .pop{ animation: popIn .22s ease-out; }
    @keyframes popIn{
      from{ transform: scale(.97); opacity:.65; }
      to{ transform: scale(1); opacity:1; }
    }

    .scoreRow{
      margin-top:12px;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }

    .scoreBox{
      border-radius:22px;
      padding:12px 14px;
      background: rgba(255,255,255,.88);
      border: 1px solid var(--stroke);
      box-shadow: 0 12px 20px rgba(15,23,42,.08);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      font-weight:1000;
    }
    .muted{
      font-weight:1000;
      color:var(--muted);
    }

    .titleBounce{ animation: titleBounce .45s ease-out; }
    @keyframes titleBounce{
      0%{ transform: translateY(0) scale(1); }
      30%{ transform: translateY(-2px) scale(1.03); }
      60%{ transform: translateY(1px) scale(.995); }
      100%{ transform: translateY(0) scale(1); }
    }

    #confetti{
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 9999;
    }
    .confetto{
      position:absolute;
      top:-20px;
      width:10px;
      height:14px;
      border-radius:3px;
      opacity:.95;
      animation: fall var(--dur) linear forwards;
      transform: translateX(var(--x)) rotate(var(--r));
      filter: drop-shadow(0 6px 10px rgba(31,41,55,.12));
    }
    @keyframes fall{
      to{
        transform: translateX(var(--x2)) translateY(110vh) rotate(calc(var(--r) + 540deg));
        opacity: 1;
      }
    }

    .toastWrap{
      position: fixed;
      left: 0; right: 0;
      top: 14px;
      display:flex;
      justify-content:center;
      pointer-events:none;
      z-index: 10000;
      padding: 0 12px;
    }
    .toast{
      background: rgba(255,255,255,.94);
      border: 2px solid rgba(229,231,235,.9);
      box-shadow: 0 14px 30px rgba(15,23,42,.14);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 1000;
      color: var(--ink);
      display:flex;
      align-items:center;
      gap:10px;
      transform: translateY(-10px) scale(.98);
      opacity: 0;
      backdrop-filter: blur(10px);
    }
    .toast.show{ animation: toastInOut 2.1s ease forwards; }
    .toast .icon{
      width:28px; height:28px;
      border-radius:999px;
      display:grid;
      place-items:center;
      color:white;
      background: linear-gradient(135deg,var(--p1),var(--p2),var(--c1));
      box-shadow: 0 10px 18px rgba(124,58,237,.18);
      flex: 0 0 auto;
      font-weight:1000;
    }
    .toast small{
      display:block;
      font-weight: 1000;
      color: var(--muted);
      margin-top: 2px;
    }
    @keyframes toastInOut{
      0%{ opacity: 0; transform: translateY(-10px) scale(.98); }
      12%{ opacity: 1; transform: translateY(0) scale(1); }
      80%{ opacity: 1; transform: translateY(0) scale(1); }
      100%{ opacity: 0; transform: translateY(-10px) scale(.98); }
    }

    .hidden{ display:none !important; }
  </style>
</head>

<body>
  <div id="confetti" aria-hidden="true"></div>

  <div class="toastWrap" aria-hidden="true">
    <div id="toast" class="toast">
      <div class="icon">ðŸŽ‰</div>
      <div>
        <div id="toastTitle">Neuer Titel!</div>
        <small id="toastSub">Titel: Autor</small>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="brand">
      <h1>Wordy</h1>
      <p id="subtitle">Start â†’ Wort ist versteckt â†’ Handy weitergeben â†’ â€žWort anzeigenâ€œ drÃ¼cken.</p>
    </div>

    <div class="card">
      <div class="panel">
        <label for="p1name">Name Spieler 1</label>
        <input id="p1name" type="text" placeholder="z. B. Mia" maxlength="18" />

        <label for="p2name" style="margin-top:12px;">Name Spieler 2 (optional)</label>
        <input id="p2name" type="text" placeholder="leer = 1 Spieler" maxlength="18" />

        <label for="difficulty" style="margin-top:12px;">Schwierigkeitsgrad</label>
        <select id="difficulty">
          <option value="leicht" selected>Leicht</option>
          <option value="mittel">Mittel</option>
          <option value="schwer">Schwer</option>
        </select>

        <label for="type" style="margin-top:12px;">Wortart</label>
        <select id="type">
          <option value="all" selected>Alles</option>
          <option value="nomen">Nomen</option>
          <option value="verb">Verb</option>
          <option value="adj">Adjektiv</option>
        </select>

        <div class="grid2">
          <button id="startBtn" class="btnPrimary" type="button">Start</button>
          <button id="restartBtn" class="btnDark" type="button">Neues Spiel</button>
        </div>
      </div>

      <div id="turnBox" class="bigTurn hidden">
        <div class="small">Jetzt dran</div>
        <div class="name" id="turnName">Spieler 1</div>
        <div class="badge" id="turnBadge">Spieler 1</div>
      </div>

      <div class="wordCard">
        <div class="wordHint" id="wordHint">Wort ist versteckt.</div>
        <div class="word pop" id="word">â€¢â€¢â€¢â€¢â€¢</div>
        <button id="revealBtn" class="btnWord" type="button">Wort anzeigen</button>
      </div>

      <div class="scoreRow">
        <div class="scoreBox">
          <span id="scoreText">Punkte (P1): 0</span>
          <span class="muted" id="titleText">Titel (P1): AnfÃ¤nger</span>
        </div>

        <div id="score2Box" class="scoreBox hidden">
          <span id="scoreText2">Punkte (P2): 0</span>
          <span class="muted" id="titleText2">Titel (P2): AnfÃ¤nger</span>
        </div>
      </div>

      <div class="grid2" style="margin-top:12px;">
        <button id="rightBtn" class="btnGood" type="button" disabled>Richtig (+1)</button>
        <button id="wrongBtn" class="btnBad" type="button" disabled>Falsch (âˆ’1)</button>
      </div>
    </div>
  </div>

  <script>
    // Titel je 5 Punkte
    const TITLES = ["AnfÃ¤nger","Autor","ErzÃ¤hler","Wortmeister","Sprachheld","Legende","Mythos","Sternenschreiber"];

    // WÃ¶rter: Deutsch + Schwierigkeitsgrade + Wortarten
    // Du kannst diese Listen jederzeit erweitern.
    const WORDS = {
      leicht: {
        nomen: ["Apfel","Hund","Katze","Schule","Buch","Ball","Auto","Blume","Baum","Brot","KÃ¤se","Milch","Sonne","Regen","Wasser","Eis","Tisch","Stuhl","Bett","Haus"],
        verb:  ["laufen","springen","lesen","malen","lachen","schlafen","essen","trinken","spielen","singen","tanzen","kaufen","helfen","finden","werfen","sehen","hÃ¶ren","rufen","sitzen","stehen"],
        adj:   ["bunt","schnell","langsam","groÃŸ","klein","nett","laut","leise","warm","kalt","rund","weich","hart","sauber","schmutzig","lustig","traurig","stark","schwach","frÃ¶hlich"]
      },
      mittel: {
        nomen: ["Abenteuer","Geheimnis","Regenbogen","Bibliothek","Schatzkarte","Kompass","Rakete","Astronaut","Roboter","Dschungel","Vulkan","Wasserfall","Labyrinth","Pyramide","Mikroskop","Experiment","Orchester","Publikum","TrophÃ¤e","Teamgeist"],
        verb:  ["entdecken","verstecken","vergleichen","erklÃ¤ren","beobachten","erfinden","trainieren","verhandeln","Ã¼berzeugen","organisieren","reparieren","untersuchen","kombinieren","vermeiden","beschreiben","planen","schummeln","Ã¼berraschen","verbessern","entscheiden"],
        adj:   ["neugierig","geheim","riesig","knifflig","tapfer","geduldig","plÃ¶tzlich","vorsichtig","aufmerksam","vertrÃ¤umt","mysteriÃ¶s","komisch","elegant","praktisch","witzig","stur","hilfsbereit","ehrlich","mutig","stolz"]
      },
      schwer: {
        nomen: ["Gerechtigkeit","Verantwortung","Interpretation","Perspektive","Widerspruch","Zusammenhang","Entscheidung","VerÃ¤nderung","Nachhaltigkeit","Bewusstsein","Selbstvertrauen","Zivilcourage","Datenschutz","Filterblase","Klimawandel","BiodiversitÃ¤t","Argumentation","Diplomatie","KomplexitÃ¤t","Konsequenz"],
        verb:  ["reflektieren","argumentieren","interpretieren","priorisieren","analysieren","kritisieren","differenzieren","veranschaulichen","abstrahieren","konkretisieren","systematisieren","koordinieren","konstruieren","formulieren","hinterfragen","relativieren","prognostizieren","strukturieren","implizieren","moderieren"],
        adj:   ["ambivalent","konsequent","nachhaltig","subtil","detailliert","kontrovers","komplex","fragil","pragmatisch","konstruktiv","kritisch","innovativ","authentisch","intuitiv","reflektiert","nuanciert","souverÃ¤n","resilient","solidarisch","autonom"]
      }
    };

    const difficultyEl = document.getElementById("difficulty");
    const typeEl = document.getElementById("type");
    const p1nameEl = document.getElementById("p1name");
    const p2nameEl = document.getElementById("p2name");

    const startBtn = document.getElementById("startBtn");
    const restartBtn = document.getElementById("restartBtn");

    const revealBtn = document.getElementById("revealBtn");
    const rightBtn = document.getElementById("rightBtn");
    const wrongBtn = document.getElementById("wrongBtn");

    const wordEl = document.getElementById("word");
    const wordHint = document.getElementById("wordHint");

    const scoreText = document.getElementById("scoreText");
    const titleText = document.getElementById("titleText");

    const score2Box = document.getElementById("score2Box");
    const scoreText2 = document.getElementById("scoreText2");
    const titleText2 = document.getElementById("titleText2");

    const turnBox = document.getElementById("turnBox");
    const turnName = document.getElementById("turnName");
    const turnBadge = document.getElementById("turnBadge");

    const confettiLayer = document.getElementById("confetti");
    const toast = document.getElementById("toast");
    const toastTitle = document.getElementById("toastTitle");
    const toastSub = document.getElementById("toastSub");

    let started = false;
    let revealed = false;
    let currentWord = null;

    let isTwoPlayers = false;
    let name1 = "Spieler 1";
    let name2 = "Spieler 2";

    let p1 = 0, p2 = 0;
    let lastTitleIndex1 = 0, lastTitleIndex2 = 0;
    let currentPlayer = 1;

    // Decks (mischt und verhindert Wiederholungen)
    const state = {}; // key="leicht|all" etc.

    function shuffle(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function getList(diff, type) {
      const bucket = WORDS[diff];
      if (!bucket) return [];
      if (type === "all") return [...bucket.nomen, ...bucket.verb, ...bucket.adj];
      return bucket[type] || [];
    }

    function ensureDeck(diff, type) {
      const key = `${diff}|${type}`;
      const list = getList(diff, type);
      if (!state[key] || state[key].idx >= state[key].deck.length) {
        state[key] = { deck: shuffle(list), idx: 0 };
      }
    }

    function popWord() {
      wordEl.classList.remove("pop");
      void wordEl.offsetWidth;
      wordEl.classList.add("pop");
    }

    function newHiddenWord() {
      const diff = difficultyEl.value;
      const type = typeEl.value;

      ensureDeck(diff, type);
      const key = `${diff}|${type}`;
      const deckState = state[key];

      currentWord = deckState.deck.length ? deckState.deck[deckState.idx++] : "Keine WÃ¶rter.";
      revealed = false;

      wordHint.textContent = "Wort ist versteckt.";
      wordEl.textContent = "â€¢â€¢â€¢â€¢â€¢";
      popWord();

      rightBtn.disabled = true;
      wrongBtn.disabled = true;
      revealBtn.disabled = false;
    }

    function clampTitleIndex(i) {
      if (i < 0) return 0;
      const max = TITLES.length - 1;
      return (i > max) ? max : i;
    }

    function titleFor(points) {
      const idx = clampTitleIndex(Math.floor(points / 5));
      return { idx, title: TITLES[idx] };
    }

    function burstConfetti() {
      const colors = ["#A78BFA","#FB7185","#34D399","#60A5FA","#F59E0B","#22C55E","#06B6D4","#F472B6"];
      const n = 44;
      const w = window.innerWidth;

      for (let i = 0; i < n; i++) {
        const c = document.createElement("div");
        c.className = "confetto";
        const x = Math.floor(Math.random() * w);
        const drift2 = (Math.random() * 240 - 120) + (Math.random() * 240 - 120);
        const r = Math.fl