<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wordy</title>
  <meta name="theme-color" content="#111827" />
  <link rel="manifest" href="manifest.json" />

  <style>
    :root{
      --ink:#0F172A;
      --muted:#64748B;
      --stroke: rgba(15,23,42,.10);
      --glass: rgba(255,255,255,.72);
      --shadow: 0 18px 50px rgba(15,23,42,.14);
      --shadow2: 0 10px 24px rgba(15,23,42,.10);
      --ring: 0 0 0 4px rgba(124,58,237,.18);

      --p1:#8B5CF6;  /* purple */
      --p2:#EC4899;  /* pink */
      --g1:#22C55E;  /* green */
      --r1:#EF4444;  /* red */
      --d1:#111827;  /* dark */
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1100px 700px at 15% 10%, #FFE3F1 0%, transparent 55%),
        radial-gradient(950px 700px at 85% 25%, #D8F5FF 0%, transparent 58%),
        radial-gradient(900px 700px at 55% 95%, #E8FFE7 0%, transparent 55%),
        linear-gradient(180deg, #FFF7FB, #F2FBFF);
      min-height:100vh;
      overflow-x:hidden;
    }

    .wrap{
      max-width:620px;
      margin:0 auto;
      padding:20px 16px 34px;
      position:relative;
    }

    /* Sticker-Deko */
    .sticker{
      position:absolute;
      width:92px; height:92px;
      opacity:.90;
      filter: drop-shadow(0 10px 18px rgba(31,41,55,.12));
      pointer-events:none;
    }
    .sticker.a{ top:10px; right:6px; transform: rotate(8deg); }
    .sticker.b{ top:86px; left:-6px; transform: rotate(-10deg); opacity:.82; }

    /* Header */
    .brand{
      text-align:center;
      margin: 6px 0 12px;
    }
    .brand h1{
      margin:0;
      font-size:44px;
      line-height:1.0;
      letter-spacing:-.6px;
      font-weight:1000;
      background: linear-gradient(135deg, var(--p1), var(--p2));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      text-shadow: 0 10px 26px rgba(124,58,237,.12);
    }
    .brand p{
      margin:8px 0 0;
      font-size:13px;
      color:var(--muted);
      font-weight:800;
    }

    .card{
      background: var(--glass);
      border: 1px solid rgba(255,255,255,.7);
      box-shadow: var(--shadow);
      border-radius: 28px;
      padding: 16px;
      backdrop-filter: blur(14px);
    }

    .panel{
      background: rgba(255,255,255,.75);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow2);
      border-radius: 22px;
      padding: 14px;
    }

    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:2px 0 8px;
      text-align:left;
      font-weight:900;
      letter-spacing:.2px;
      text-transform: uppercase;
    }

    select, button{
      width:100%;
      font-size:16px;
      border-radius:18px;
      padding:14px 14px;
    }

    select{
      background:#fff;
      color:var(--ink);
      border:1px solid var(--stroke);
      outline:none;
      box-shadow: 0 8px 18px rgba(15,23,42,.06);
    }
    select:focus{ box-shadow: var(--ring); border-color: rgba(124,58,237,.35); }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:12px;
    }

    button{
      border:none;
      cursor:pointer;
      font-weight:1000;
      letter-spacing:.2px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      box-shadow: 0 12px 20px rgba(15,23,42,.12);
      transition: transform .08s ease, filter .15s ease;
      position:relative;
      overflow:hidden;
    }
    button:active{ transform: translateY(1px); }
    button:disabled{ opacity:.55; cursor:not-allowed; filter:saturate(.6); }

    /* ‚ÄúPlastik‚Äù-Glanz */
    button::after{
      content:"";
      position:absolute;
      inset:-40% -20% auto -20%;
      height:120%;
      background: linear-gradient(120deg, rgba(255,255,255,.0), rgba(255,255,255,.32), rgba(255,255,255,.0));
      transform: rotate(10deg);
      opacity:.55;
      pointer-events:none;
    }

    .btnPrimary{ background: linear-gradient(135deg, var(--p1), var(--p2)); color:white; }
    .btnDark{ background: linear-gradient(135deg, var(--d1), #334155); color:white; }
    .btnGood{ background: linear-gradient(135deg, #16A34A, #22C55E); color:white; }
    .btnBad{ background: linear-gradient(135deg, #EF4444, #F97316); color:white; }
    .btnWord{ background: linear-gradient(135deg, #06B6D4, #22C55E); color:white; }

    .wordCard{
      margin-top:14px;
      border-radius:26px;
      padding:18px 16px;
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(124,58,237,.18);
      box-shadow: 0 16px 30px rgba(15,23,42,.12);
      text-align:center;
      min-height: 120px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:10px;
    }

    .word{
      font-size:40px;
      font-weight:1000;
      letter-spacing:-.4px;
      line-height:1.05;
      padding: 4px 6px;
      will-change: transform, opacity;
    }

    .wordHint{
      font-size:12px;
      color:var(--muted);
      font-weight:800;
    }

    .pop{ animation: popIn .22s ease-out; }
    @keyframes popIn{
      from{ transform: scale(.97); opacity:.65; }
      to{ transform: scale(1); opacity:1; }
    }

    .scoreRow{
      margin-top:12px;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }

    .scoreBox{
      border-radius:20px;
      padding:12px 14px;
      background: rgba(255,255,255,.85);
      border: 1px solid var(--stroke);
      box-shadow: 0 12px 20px rgba(15,23,42,.08);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      font-weight:1000;
    }
    .muted{
      font-weight:900;
      color:var(--muted);
    }

    .turn{
      margin-top:12px;
      border-radius: 22px;
      padding: 12px 14px;
      background: rgba(255,255,255,.82);
      border: 1px solid rgba(124,58,237,.18);
      box-shadow: 0 12px 18px rgba(15,23,42,.08);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      font-weight:1000;
    }
    .pill{
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      background: rgba(124,58,237,.12);
      border:1px solid rgba(124,58,237,.22);
      color:#5B21B6;
      white-space:nowrap;
    }

    .titleBounce{ animation: titleBounce .45s ease-out; }
    @keyframes titleBounce{
      0%{ transform: translateY(0) scale(1); }
      30%{ transform: translateY(-2px) scale(1.03); }
      60%{ transform: translateY(1px) scale(.995); }
      100%{ transform: translateY(0) scale(1); }
    }

    /* Konfetti */
    #confetti{
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 9999;
    }
    .confetto{
      position:absolute;
      top:-20px;
      width:10px;
      height:14px;
      border-radius:3px;
      opacity:.95;
      animation: fall var(--dur) linear forwards;
      transform: translateX(var(--x)) rotate(var(--r));
      filter: drop-shadow(0 6px 10px rgba(31,41,55,.12));
    }
    @keyframes fall{
      to{
        transform: translateX(var(--x2)) translateY(110vh) rotate(calc(var(--r) + 540deg));
        opacity: 1;
      }
    }

    /* Level-Up Toast */
    .toastWrap{
      position: fixed;
      left: 0; right: 0;
      top: 14px;
      display:flex;
      justify-content:center;
      pointer-events:none;
      z-index: 10000;
      padding: 0 12px;
    }
    .toast{
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(229,231,235,.9);
      box-shadow: 0 14px 30px rgba(15,23,42,.14);
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 1000;
      color: var(--ink);
      display:flex;
      align-items:center;
      gap:10px;
      transform: translateY(-10px) scale(.98);
      opacity: 0;
      backdrop-filter: blur(10px);
    }
    .toast.show{ animation: toastInOut 2.1s ease forwards; }
    .badge{
      width:28px; height:28px;
      border-radius:999px;
      display:grid;
      place-items:center;
      color:white;
      background: linear-gradient(135deg,var(--p1),var(--p2));
      box-shadow: 0 10px 18px rgba(124,58,237,.18);
      flex: 0 0 auto;
    }
    .toast small{
      display:block;
      font-weight: 900;
      color: var(--muted);
      margin-top: 2px;
    }
    @keyframes toastInOut{
      0%{ opacity: 0; transform: translateY(-10px) scale(.98); }
      12%{ opacity: 1; transform: translateY(0) scale(1); }
      80%{ opacity: 1; transform: translateY(0) scale(1); }
      100%{ opacity: 0; transform: translateY(-10px) scale(.98); }
    }

    .hidden{ display:none !important; }
  </style>
</head>

<body>
  <div id="confetti" aria-hidden="true"></div>

  <div class="toastWrap" aria-hidden="true">
    <div id="toast" class="toast">
      <div class="badge">üéâ</div>
      <div>
        <div id="toastTitle">Neuer Titel!</div>
        <small id="toastSub">Titel: Autor</small>
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- Sticker: Astronaut -->
    <svg class="sticker a" viewBox="0 0 120 120" aria-hidden="true">
      <defs>
        <linearGradient id="gA" x1="0" x2="1">
          <stop offset="0" stop-color="#A78BFA"/><stop offset="1" stop-color="#FB7185"/>
        </linearGradient>
      </defs>
      <circle cx="60" cy="60" r="52" fill="url(#gA)" opacity="0.22"/>
      <circle cx="62" cy="52" r="22" fill="#fff" stroke="#94A3B8" stroke-width="3"/>
      <rect x="42" y="70" width="44" height="30" rx="14" fill="#fff" stroke="#94A3B8" stroke-width="3"/>
      <rect x="50" y="46" width="24" height="16" rx="8" fill="#0EA5E9" opacity=".25"/>
      <circle cx="48" cy="86" r="6" fill="#22C55E" opacity=".75"/>
      <circle cx="76" cy="86" r="6" fill="#F59E0B" opacity=".75"/>
      <path d="M36 78c-10 6-16 14-16 22" stroke="#94A3B8" stroke-width="3" fill="none" stroke-linecap="round"/>
      <path d="M88 78c10 6 16 14 16 22" stroke="#94A3B8" stroke-width="3" fill="none" stroke-linecap="round"/>
    </svg>

    <!-- Sticker: Dino -->
    <svg class="sticker b" viewBox="0 0 120 120" aria-hidden="true">
      <defs>
        <linearGradient id="gD" x1="0" x2="1">
          <stop offset="0" stop-color="#34D399"/><stop offset="1" stop-color="#60A5FA"/>
        </linearGradient>
      </defs>
      <circle cx="60" cy="60" r="52" fill="url(#gD)" opacity="0.22"/>
      <path d="M34 78c0-18 12-36 34-36 20 0 30 12 30 28 0 16-12 28-30 28H52c-10 0-18-8-18-20z"
            fill="#FFFFFF" stroke="#94A3B8" stroke-width="3" stroke-linejoin="round"/>
      <circle cx="76" cy="64" r="3.5" fill="#0F172A"/>
      <path d="M70 73c4 5 10 5 14 0" stroke="#FB7185" stroke-width="3" fill="none" stroke-linecap="round"/>
      <path d="M46 54l8-10 8 10" stroke="#F59E0B" stroke-width="4" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M60 44l8-10 8 10" stroke="#F59E0B" stroke-width="4" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>

    <div class="brand">
      <h1>Wordy</h1>
      <p id="subtitle">Start ‚Üí Wort ist versteckt ‚Üí Handy weitergeben ‚Üí ‚ÄûWort anzeigen‚Äú dr√ºcken.</p>
    </div>

    <div class="card">
      <div class="panel">
        <label for="lang" id="labLang">Sprache</label>
        <select id="lang">
          <option value="de">Deutsch</option>
          <option value="it">Italiano</option>
        </select>

        <label for="mode" id="labMode" style="margin-top:12px;">Modus</label>
        <select id="mode">
          <option value="solo" selected>1 Spieler</option>
          <option value="two">2 Spieler</option>
        </select>

        <label for="type" id="labType" style="margin-top:12px;">Wortart</label>
        <select id="type">
          <option value="all" selected>Alles</option>
          <option value="nomen">Nomen</option>
          <option value="verb">Verb</option>
          <option value="adj">Adjektiv</option>
        </select>

        <div class="grid2">
          <button id="startBtn" class="btnPrimary" type="button">Start</button>
          <button id="restartBtn" class="btnDark" type="button">Neues Spiel</button>
        </div>
      </div>

      <div id="turnBox" class="turn hidden">
        <div id="turnText">Am Zug: Spieler 1</div>
        <div class="pill" id="turnPill">P1</div>
      </div>

      <div class="wordCard">
        <div class="wordHint" id="wordHint">Wort ist versteckt.</div>
        <div class="word" id="word">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</div>
        <button id="revealBtn" class="btnWord" type="button">Wort anzeigen</button>
      </div>

      <div class="scoreRow">
        <div class="scoreBox">
          <span id="scoreText">Punkte (P1): 0</span>
          <span class="muted" id="titleText">Titel (P1): Anf√§nger</span>
        </div>

        <div id="score2Box" class="scoreBox hidden">
          <span id="scoreText2">Punkte (P2): 0</span>
          <span class="muted" id="titleText2">Titel (P2): Anf√§nger</span>
        </div>
      </div>

      <div class="grid2" id="resultRow" style="margin-top:12px;">
        <button id="rightBtn" class="btnGood" type="button" disabled>Richtig (+1)</button>
        <button id="wrongBtn" class="btnBad" type="button" disabled>Falsch (‚àí1)</button>
      </div>
    </div>
  </div>

  <script>
    const TITLES = {
      de: ["Anf√§nger","Autor","Erz√§hler","Wortmeister","Sprachheld","Legende","Mythos","Sternenschreiber"],
      it: ["Principiante","Autore","Narratore","Maestro delle parole","Eroe della lingua","Leggenda","Mito","Scrittore stellare"]
    };

    const WORDS = {
      de: {
        nomen: ["Apfel","Hund","Schule","Buch","Fahrrad","Wald","Meer","Rakete","Roboter","Freundschaft","Kuchen","Berg","Bibliothek","Detektiv","Regenbogen"],
        verb:  ["laufen","springen","lesen","denken","schreiben","malen","lachen","fl√ºstern","klettern","bauen","entdecken","helfen","r√§tseln","suchen","trainieren"],
        adj:   ["mutig","lustig","leise","schnell","klug","freundlich","geheim","riesig","bunt","neugierig","geduldig","stark","zart","chaotisch","tapfer"]
      },
      it: {
        nomen: ["mela","cane","scuola","libro","bicicletta","bosco","mare","razzo","robot","amicizia","torta","montagna","biblioteca","detective","arcobaleno"],
        verb:  ["correre","saltare","leggere","pensare","scrivere","dipingere","ridere","sussurrare","arrampicare","costruire","scoprire","aiutare","indovinare","cercare","allenarsi"],
        adj:   ["coraggioso","divertente","silenzioso","veloce","intelligente","gentile","segreto","gigante","colorato","curioso","paziente","forte","delicato","caotico","valoroso"]
      }
    };

    const langEl = document.getElementById("lang");
    const modeEl = document.getElementById("mode");
    const typeEl = document.getElementById("type");

    const startBtn = document.getElementById("startBtn");
    const restartBtn = document.getElementById("restartBtn");

    const revealBtn = document.getElementById("revealBtn");
    const rightBtn = document.getElementById("rightBtn");
    const wrongBtn = document.getElementById("wrongBtn");

    const wordEl = document.getElementById("word");
    const wordHint = document.getElementById("wordHint");

    const scoreText = document.getElementById("scoreText");
    const titleText = document.getElementById("titleText");

    const score2Box = document.getElementById("score2Box");
    const scoreText2 = document.getElementById("scoreText2");
    const titleText2 = document.getElementById("titleText2");

    const subtitle = document.getElementById("subtitle");
    const labLang = document.getElementById("labLang");
    const labMode = document.getElementById("labMode");
    const labType = document.getElementById("labType");

    const confettiLayer = document.getElementById("confetti");
    const toast = document.getElementById("toast");
    const toastTitle = document.getElementById("toastTitle");
    const toastSub = document.getElementById("toastSub");

    const turnBox = document.getElementById("turnBox");
    const turnText = document.getElementById("turnText");
    const turnPill = document.getElementById("turnPill");

    // Game state
    let started = false;
    let revealed = false;
    let currentWord = null;

    let p1 = 0, p2 = 0;
    let lastTitleIndex1 = 0, lastTitleIndex2 = 0;
    let currentPlayer = 1;

    const state = {}; // decks: key="lang|type"

    function shuffle(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function getList(lang, type) {
      if (type === "all") return [...WORDS[lang].nomen, ...WORDS[lang].verb, ...WORDS[lang].adj];
      return WORDS[lang][type] || [];
    }

    function ensureDeck(lang, type) {
      const key = `${lang}|${type}`;
      const list = getList(lang, type);
      if (!state[key] || state[key].idx >= state[key].deck.length) {
        state[key] = { deck: shuffle(list), idx: 0 };
      }
    }

    function popWord() {
      wordEl.classList.remove("pop");
      void wordEl.offsetWidth;
      wordEl.classList.add("pop");
    }

    function newHiddenWord() {
      const lang = langEl.value;
      const type = typeEl.value;

      ensureDeck(lang, type);
      const key = `${lang}|${type}`;
      const deckState = state[key];

      currentWord = deckState.deck.length ? deckState.deck[deckState.idx++] : ((lang==="it") ? "Nessuna parola." : "Keine W√∂rter.");
      revealed = false;

      wordHint.textContent = (lang === "it") ? "Parola nascosta." : "Wort ist versteckt.";
      wordEl.textContent = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
      popWord();

      // Ergebnisbuttons erst aktiv, wenn das Wort angezeigt wurde (fair)
      rightBtn.disabled = true;
      wrongBtn.disabled = true;
      revealBtn.disabled = false;
    }

    function clampTitleIndex(i) {
      if (i < 0) return 0;
      const max = TITLES.de.length - 1;
      return (i > max) ? max : i;
    }

    function titleFor(lang, points) {
      const idx = clampTitleIndex(Math.floor(points / 5));
      return { idx, title: TITLES[lang][idx] };
    }

    function burstConfetti() {
      const colors = ["#A78BFA","#FB7185","#34D399","#60A5FA","#F59E0B","#22C55E","#06B6D4","#F472B6"];
      const n = 44;
      const w = window.innerWidth;

      for (let i = 0; i < n; i++) {
        const c = document.createElement("div");
        c.className = "confetto";
        const x = Math.floor(Math.random() * w);
        const drift2 = (Math.random() * 240 - 120) + (Math.random() * 240 - 120);
        const r = Math.floor(Math.random() * 360);
        const dur = (Math.random() * 0.9 + 0.9).toFixed(2) + "s";

        c.style.left = x + "px";
        c.style.background = colors[Math.floor(Math.random() * colors.length)];
        c.style.setProperty("--x", "0px");
        c.style.setProperty("--x2", drift2 + "px");
        c.style.setProperty("--r", r + "deg");
        c.style.setProperty("--dur", dur);
        c.style.width = (8 + Math.random() * 8).toFixed(0) + "px";
        c.style.height = (10 + Math.random() * 10).toFixed(0) + "px";
        c.style.opacity = (0.75 + Math.random() * 0.25).toFixed(2);

        confettiLayer.appendChild(c);
        c.addEventListener("animationend", () => c.remove());
      }
    }

    function bounce(el) {
      el.classList.remove("titleBounce");
      void el.offsetWidth;
      el.classList.add("titleBounce");
    }

    function showLevelUpToast(lang, whoLabel, newTitle) {
      toast.classList.remove("show");
      void toast.offsetWidth;

      if (lang === "it") {
        toastTitle.textContent = "Nuovo titolo!";
        toastSub.textContent = `${whoLabel}: ${newTitle}`;
      } else {
        toastTitle.textContent = "Neuer Titel!";
        toastSub.textContent = `${whoLabel}: ${newTitle}`;
      }

      toast.classList.add("show");
    }

    function updateTurnUI() {
      const lang = langEl.value;
      const two = modeEl.value === "two";
      if (!two) {
        turnBox.classList.add("hidden");
        return;
      }
      turnBox.classList.remove("hidden");
      if (lang === "it") {
        turnText.textContent = `Tocca a: Giocatore ${currentPlayer}`;
      } else {
        turnText.textContent = `Am Zug: Spieler ${currentPlayer}`;
      }
      turnPill.textContent = currentPlayer === 1 ? "P1" : "P2";
      turnPill.style.background = currentPlayer === 1 ? "rgba(124,58,237,.12)" : "rgba(34,197,94,.12)";
      turnPill.style.borderColor = currentPlayer === 1 ? "rgba(124,58,237,.22)" : "rgba(34,197,94,.22)";
      turnPill.style.color = currentPlayer === 1 ? "#5B21B6" : "#166534";
    }

    function updateScoresUI() {
      const lang = langEl.value;
      const two = modeEl.value === "two";

      const t1 = titleFor(lang, p1);
      scoreText.textContent = (lang === "it") ? `Punti (P1): ${p1}` : `Punkte (P1): ${p1}`;
      titleText.textContent = (lang === "it") ? `Titolo (P1): ${t1.title}` : `Titel (P1): ${t1.title}`;

      if (two) {
        score2Box.classList.remove("hidden");
        const t2 = titleFor(lang, p2);
        scoreText2.textContent = (lang === "it") ? `Punti (P2): ${p2}` : `Punkte (P2): ${p2}`;
        titleText2.textContent = (lang === "it") ? `Titolo (P2): ${t2.title}` : `Titel (P2): ${t2.title}`;

        if (t1.idx > lastTitleIndex1) {
          bounce(titleText); burstConfetti();
          showLevelUpToast(lang, "P1", t1.title);
        }
        if (t2.idx > lastTitleIndex2) {
          bounce(titleText2); burstConfetti();
          showLevelUpToast(lang, "P2", t2.title);
        }
        lastTitleIndex1 = t1.idx;
        lastTitleIndex2 = t2.idx;
      } else {
        score2Box.classList.add("hidden");
        if (t1.idx > lastTitleIndex1) {
          bounce(titleText); burstConfetti();
          showLevelUpToast(lang, (lang==="it")?"Tu":"Du", t1.title);
        }
        lastTitleIndex1 = t1.idx;
      }
    }

    function setUiLanguage() {
      const lang = langEl.value;

      if (lang === "it") {
        labLang.textContent = "Lingua";
        labMode.textContent = "Modalit√†";
        labType.textContent = "Categoria";

        modeEl.querySelector('option[value="solo"]').textContent = "1 Giocatore";
        modeEl.querySelector('option[value="two"]').textContent = "2 Giocatori";

        typeEl.querySelector('option[value="all"]').textContent = "Tutto";
        typeEl.querySelector('option[value="nomen"]').textContent = "Sostantivo";
        typeEl.querySelector('option[value="verb"]').textContent = "Verbo";
        typeEl.querySelector('option[value="adj"]').textContent = "Aggettivo";

        startBtn.textContent = started ? "In corso‚Ä¶" : "Start";
        restartBtn.textContent = "Nuova partita";
        revealBtn.textContent = "Mostra parola";
        rightBtn.textContent = "Giusto (+1)";
        wrongBtn.textContent = "Sbagliato (‚àí1)";

        subtitle.textContent = "Start ‚Üí parola nascosta ‚Üí passa il telefono ‚Üí ‚ÄòMostra parola‚Äô.";
      } else {
        labLang.textContent = "Sprache";
        labMode.textContent = "Modus";
        labType.textContent = "Wortart";

        modeEl.querySelector('option[value="solo"]').textContent = "1 Spieler";
        modeEl.querySelector('option[value="two"]').textContent = "2 Spieler";

        typeEl.querySelector('option[value="all"]').textContent = "Alles";
        typeEl.querySelector('option[value="nomen"]').textContent = "Nomen";
        typeEl.querySelector('option[value="verb"]').textContent = "Verb";
        typeEl.querySelector('option[value="adj"]').textContent = "Adjektiv";

        startBtn.textContent = started ? "L√§uft‚Ä¶" : "Start";
        restartBtn.textContent = "Neues Spiel";
        revealBtn.textContent = "Wort anzeigen";
        rightBtn.textContent = "Richtig (+1)";
        wrongBtn.textContent = "Falsch (‚àí1)";

        subtitle.textContent = "Start ‚Üí Wort ist versteckt ‚Üí Handy weitergeben ‚Üí ‚ÄûWort anzeigen‚Äú dr√ºcken.";
      }

      updateTurnUI();
      updateScoresUI();
    }

    function resetGame() {
      started = false;
      revealed = false;
      currentWord = null;

      p1 = 0; p2 = 0;
      currentPlayer = 1;
      lastTitleIndex1 = 0;
      lastTitleIndex2 = 0;

      langEl.disabled = false;
      modeEl.disabled = false;
      typeEl.disabled = false;
      startBtn.disabled = false;

      wordHint.textContent = (langEl.value === "it") ? "Parola nascosta." : "Wort ist versteckt.";
      wordEl.textContent = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
      popWord();

      revealBtn.disabled = true;
      rightBtn.disabled = true;
      wrongBtn.disabled = true;

      setUiLanguage();
    }

    function startGame() {
      started = true;

      langEl.disabled = true;
      modeEl.disabled = true;
      typeEl.disabled = true;
      startBtn.disabled = true;

      revealBtn.disabled = false;
      setUiLanguage();
      updateTurnUI();
      updateScoresUI();
      newHiddenWord(); // prepares first word hidden
    }

    function revealWord() {
      if (!started || revealed) return;
      revealed = true;

      wordHint.textContent = (langEl.value === "it") ? "Parola:" : "Wort:";
      wordEl.textContent = currentWord || "‚Äî";
      popWord();

      // Nun darf bewertet werden
      rightBtn.disabled = false;
      wrongBtn.disabled = false;

      // Reveal nur einmal pro Runde
      revealBtn.disabled = true;
    }

    function applyResult(delta) {
      if (!started) return;

      const two = modeEl.value === "two";
      if (!two) {
        p1 += delta;
      } else {
        if (currentPlayer === 1) p1 += delta;
        else p2 += delta;
      }

      updateScoresUI();

      // N√§chster Spieler (bei 2 Spieler), aber NEUES WORT erst nach extra Klick (Reveal)
      if (two) {
        currentPlayer = (currentPlayer === 1) ? 2 : 1;
        updateTurnUI();
      }

      // Runde beenden: Wort wieder verstecken; neues Wort vorbereiten
      newHiddenWord();
    }

    // Init
    resetGame();

    startBtn.addEventListener("click", startGame);
    restartBtn.addEventListener("click", resetGame);
    revealBtn.addEventListener("click", revealWord);
    rightBtn.addEventListener("click", () => applyResult(+1));
    wrongBtn.addEventListener("click", () => applyResult(-1));
    langEl.addEventListener("change", setUiLanguage);
    modeEl.addEventListener("change", setUiLanguage);

    // Offline/Cache
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => navigator.serviceWorker.register("./sw.js"));
    }
  </script>
</body>
</html>