<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Wordy - Comic Edition</title>
  
  <link rel="icon" type="image/png" href="icon.png">
  <link rel="apple-touch-icon" href="icon.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@500;700&family=Luckiest+Guy&family=Nunito:wght@700;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      /* Knalligere Farben f√ºr den Comic-Look */
      --primary: #8b5cf6;       
      --primary-dark: #7c3aed;
      --accent: #ff4757;        /* Satteres Rot/Pink */
      --fun-yellow: #ffa502;    /* Satteres Orange/Gelb */
      --fun-blue: #1e90ff;      
      
      --bg-gradient: linear-gradient(180deg, #ffeaa7 0%, #81ecec 100%); /* Frischerer Hintergrund */
      
      --success: #2ed573;
      --danger: #ff4757;
      --warning: #ffa502;
      --dark: #2f3542;
      --muted: #747d8c;
      
      --radius-xl: 28px;
      --radius-btn: 50px; 
      --shadow-card: 0 14px 35px rgba(0,0,0,0.12);
      --shadow-text: 3px 3px 0px rgba(0,0,0,0.2);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0;
      font-family: "Nunito", sans-serif;
      background: var(--bg-gradient);
      color: var(--dark);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px;
      user-select: none;
      overflow-x: hidden;
    }

    /* NEU: Comic Font f√ºr Logo */
    h1.comic-logo { 
      font-family: "Luckiest Guy", cursive; 
      margin: 0; 
      letter-spacing: 1.5px;
      text-transform: uppercase;
    }

    h2, .fun-font { font-family: "Fredoka", sans-serif; margin: 0; letter-spacing: 0.5px; }
    
    /* Animationen */
    
    /* 1. Jelly / Wabbel Effekt f√ºr das Logo */
    @keyframes jelly {
      0% { transform: scale(1, 1); }
      25% { transform: scale(0.9, 1.1) rotate(-3deg); }
      50% { transform: scale(1.1, 0.9) rotate(3deg); }
      75% { transform: scale(0.95, 1.05) rotate(-1deg); }
      100% { transform: scale(1, 1) rotate(0deg); }
    }

    @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 80% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); } }
    @keyframes slideUp { from { transform: translateY(50px); opacity:0; } to { transform: translateY(0); opacity:1; } }
    @keyframes pulseRed { 0% { transform: scale(1); } 50% { transform: scale(1.1); color: var(--danger); border-color:var(--danger); } 100% { transform: scale(1); } }

    .header { text-align: center; margin-bottom: 25px; margin-top: 10px; }
    .header h1 {
      font-size: 4.5rem; /* Gr√∂√üer! */
      line-height: 1;
      color: #ff6b81;
      
      /* Der Comic-Look: Dicker wei√üer Rand + Schlagschatten */
      text-shadow: 
        4px 4px 0px #ffffff, 
        -2px -2px 0px #ffffff,  
        2px -2px 0px #ffffff,
        -2px 2px 0px #ffffff,
        4px 4px 0px #2f3542; /* Harter Schatten */
      
      animation: jelly 2s infinite ease-in-out; /* Die Bewegung! */
      transform-origin: center bottom;
    }

    .app-container { width: 100%; max-width: 480px; margin: 0 auto; padding-bottom: 40px; position: relative; z-index: 10; }

    .card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(12px);
      border-radius: var(--radius-xl);
      padding: 24px;
      box-shadow: var(--shadow-card);
      border: 4px solid #fff;
      margin-bottom: 20px;
      animation: slideUp 0.3s ease-out;
    }

    .input-group { margin-bottom: 16px; text-align: left; }
    label { display: block; font-size: 0.8rem; text-transform: uppercase; color: var(--primary); margin-bottom: 6px; font-weight: 900; }
    
    input, select {
      width: 100%; padding: 14px; border-radius: 20px;
      border: 3px solid #dfe4ea; font-size: 1.1rem; font-weight: 800; color: var(--dark);
      background: #f1f2f6;
    }
    input:focus, select:focus { border-color: var(--primary); outline: none; background: #fff; }

    .btn {
      width: 100%; padding: 18px; border-radius: var(--radius-btn);
      font-weight: 900; font-size: 1.2rem;
      display: inline-flex; align-items: center; justify-content: center;
      gap: 10px;
      transition: transform 0.1s, box-shadow 0.1s;
      box-shadow: 0 5px 0 rgba(0,0,0,0.15); /* 3D Button */
      margin-bottom: 10px; 
      cursor: pointer; border: none;
      text-transform: uppercase; letter-spacing: 0.5px;
    }
    .btn:active { transform: translateY(4px); box-shadow: 0 1px 0 rgba(0,0,0,0.15); }
    .btn:disabled { opacity: 0.5; filter: grayscale(1); cursor: not-allowed; box-shadow: none; transform: translateY(2px); }

    .btn-primary { background: linear-gradient(135deg, #a29bfe, #6c5ce7); color: white; }
    .btn-secondary { background: white; color: var(--dark); border: 3px solid #dfe4ea; box-shadow: 0 5px 0 #ced6e0; }
    .btn-success { background: linear-gradient(135deg, #7bed9f, #2ed573); color: white; text-shadow: 0 1px 1px rgba(0,0,0,0.2); }
    .btn-danger { background: linear-gradient(135deg, #ff6b81, #ff4757); color: white; text-shadow: 0 1px 1px rgba(0,0,0,0.2); }
    .btn-warning { background: linear-gradient(135deg, #ffeaa7, #fdcb6e); color: var(--dark); }
    .btn-small { padding: 10px 20px; font-size: 0.9rem; width: auto; }

    /* CSS Flaggen */
    .lang-btn {
      background: white; border: 3px solid #dfe4ea; border-radius: 24px;
      padding: 20px; text-align: center; cursor: pointer; transition: all 0.2s;
      display: flex; flex-direction: column; align-items: center; gap: 10px;
      box-shadow: 0 4px 0 #dfe4ea;
    }
    .lang-btn:active { transform: translateY(4px); box-shadow: none; }
    .lang-btn.selected { border-color: var(--primary); background: #f3f0ff; transform: scale(1.05); }
    
    .flag {
      width: 60px; height: 40px; border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
      position: relative; overflow: hidden;
      border: 1px solid rgba(0,0,0,0.1);
    }
    .flag-de { background: linear-gradient(to bottom, #000 33.3%, #D00 33.3%, #D00 66.6%, #FFC000 66.6%); }
    .flag-it { background: linear-gradient(to right, #009246 33.3%, #fff 33.3%, #fff 66.6%, #ce2b37 66.6%); }

    .turn-badge {
      display: inline-block;
      background: #dfe6e9; color: var(--dark);
      padding: 6px 16px; border-radius: 20px;
      font-weight: 900; font-size: 0.9rem; margin-bottom: 5px;
    }

    .word-display {
      text-align: center; min-height: 200px;
      display: flex; flex-direction: column; justify-content: center; align-items: center;
      background: #ffffff; border-radius: 24px; border: 4px solid #dfe4ea;
      margin: 15px 0;
      position: relative;
    }
    .word-text { font-size: 2.5rem; line-height: 1.1; color: var(--dark); margin: 10px 0; font-weight: 900; }
    .word-hint { font-size: 1.1rem; color: var(--muted); font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .hidden { display: none !important; }

    /* Timer Style - Prominent */
    .timer-box {
      font-family: "Luckiest Guy", cursive;
      font-size: 2.5rem;
      text-align: center;
      margin-bottom: 10px;
      color: white;
      text-shadow: 2px 2px 0 rgba(0,0,0,0.2);
      background: var(--dark);
      padding: 5px 25px;
      border-radius: 40px;
      border: 4px solid white;
      display: inline-block;
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }
    .timer-warning {
      background: var(--danger);
      animation: pulseRed 0.8s infinite;
    }

    .scoreboard-mini { display: grid; gap: 8px; margin-top: 15px; }
    .score-item {
      background: white; padding: 10px 16px; border-radius: 16px;
      display: flex; justify-content: space-between; align-items: center;
      border: 2px solid #dfe4ea;
    }
    
    .highscore-list { list-style: none; padding: 0; margin: 0; max-height: 300px; overflow-y: auto; }
    .highscore-entry {
      background: white; border-radius: 16px; padding: 12px; margin-bottom: 8px;
      border-bottom: 3px solid #dfe4ea; display: flex; justify-content: space-between; align-items: center;
    }
    .hs-date { font-size: 0.75rem; color: var(--muted); display: block; }
    .hs-names { font-weight: 800; font-size: 0.95rem; }
    .hs-score { font-size: 1.2rem; font-weight: 900; color: var(--primary); }

    /* Overlays */
    .overlay {
      position: fixed; inset: 0; background: rgba(47, 53, 66, 0.9);
      backdrop-filter: blur(8px); z-index: 999;
      display: flex; align-items: center; justify-content: center; padding: 20px;
      opacity: 0; pointer-events: none; transition: opacity 0.3s;
    }
    .overlay.active { opacity: 1; pointer-events: all; }
    .modal {
      background: white; width: 100%; max-width: 400px;
      border-radius: 35px; padding: 30px; text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
      border: 5px solid #fff;
    }
    
    .help-emoji-display {
      font-size: 8rem; line-height: 1; margin: 15px 0;
      animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      filter: drop-shadow(0 10px 10px rgba(0,0,0,0.1));
    }

    /* Score in Round Summary */
    .round-score-big {
        font-family: "Luckiest Guy", cursive;
        font-size: 5rem;
        color: var(--success);
        text-shadow: 3px 3px 0 #fff, 0 0 0 5px rgba(0,0,0,0.05);
        margin: 10px 0;
        animation: popIn 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    #confetti { position: fixed; inset: 0; pointer-events: none; z-index: 1000; }
  </style>
</head>

<body>
  <canvas id="confetti"></canvas>

  <div class="app-container">
    <header class="header">
      <h1 class="comic-logo">Wordy</h1>
    </header>

    <div id="screenLanguage" class="card">
      <h2 class="fun-font" style="text-align:center; margin-bottom:20px;">Sprache / Lingua</h2>
      <div class="grid-2">
        <div class="lang-btn" onclick="setLanguage('de')">
          <div class="flag flag-de"></div>
          <span class="fun-font">Deutsch</span>
        </div>
        <div class="lang-btn" onclick="setLanguage('it')">
          <div class="flag flag-it"></div>
          <span class="fun-font">Italiano</span>
        </div>
      </div>
    </div>

    <div id="screenSettings" class="card hidden">
      <div class="grid-2">
        <div>
          <label data-i18n="p1">Spieler 1</label>
          <input id="p1name" type="text" maxlength="10">
          <select id="p1class" style="margin-top:5px;">
            <option value="warrior">‚öîÔ∏è Krieger</option>
            <option value="mage">ü™Ñ Magier</option>
            <option value="rogue">üó°Ô∏è Schurke</option>
            <option value="bard">üéµ Barde</option>
            <option value="healer">üåø Heiler</option>
          </select>
        </div>
        <div>
          <label data-i18n="p2">Spieler 2</label>
          <input id="p2name" type="text" maxlength="10">
          <select id="p2class" style="margin-top:5px;">
            <option value="warrior">‚öîÔ∏è Krieger</option>
            <option value="mage">ü™Ñ Magier</option>
            <option value="rogue" selected>üó°Ô∏è Schurke</option>
            <option value="bard">üéµ Barde</option>
            <option value="healer">üåø Heiler</option>
          </select>
        </div>
      </div>

      <div class="input-group" style="margin-top:15px;">
        <label data-i18n="difficulty">Schwierigkeit</label>
        <select id="difficulty">
          <option value="leicht" data-i18n="easy">Leicht</option>
          <option value="mittel" data-i18n="medium" selected>Mittel</option>
          <option value="schwer" data-i18n="hard">Schwer</option>
        </select>
      </div>

      <button id="startBtn" class="btn btn-primary">
        <i class="fa-solid fa-play"></i> <span data-i18n="start">Start</span>
      </button>
      
      <div style="text-align:center; margin-top:10px;">
        <button class="btn btn-secondary btn-small" id="showHighscoreBtn">
           üèÜ <span data-i18n="btnHighscore">Highscore</span>
        </button>
      </div>
    </div>

    <div id="screenGame" class="hidden">
      
      <div style="text-align:center;">
        <div id="timerDisplay" class="timer-box">02:00</div>
      </div>

      <div class="card" style="margin-top:10px;">
        <div id="turnBox" style="text-align:center; margin-bottom:10px;">
          <div class="fun-font" style="font-size:1.6rem; color:var(--dark); display:flex; justify-content:center; align-items:center; gap:8px;">
            <span id="turnIcon"></span> <span id="turnName">Spieler 1</span>
          </div>
        </div>

        <div class="word-display">
          <div id="wordHint" class="word-hint">...</div>
          <div id="wordText" class="word-text fun-font">...</div>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 2fr 1fr; gap:10px;">
           <button id="wrongBtn" class="btn btn-danger">
            <i class="fa-solid fa-xmark"></i>
          </button>
          
          <button id="correctBtn" class="btn btn-success" style="font-size:1.5rem;">
            <i class="fa-solid fa-check"></i> <span data-i18n="correct">JA!</span>
          </button>
          
          <button id="helpBtn" class="btn btn-warning">
            <i class="fa-solid fa-lightbulb"></i>
          </button>
        </div>
      </div>

      <div class="scoreboard-mini">
        <div class="score-item" id="scoreRow1">
          <div><span id="iconP1"></span> <b id="nameP1">P1</b></div>
          <div style="font-weight:900; color:var(--primary);"><span id="ptsP1">0</span></div>
        </div>
        <div class="score-item hidden" id="scoreRow2">
          <div><span id="iconP2"></span> <b id="nameP2">P2</b></div>
          <div style="font-weight:900; color:var(--primary);"><span id="ptsP2">0</span></div>
        </div>
      </div>

      <div class="grid-2" style="margin-top:20px;">
        <button id="finishBtn" class="btn btn-secondary btn-small">
          üèÅ <span data-i18n="finish">Beenden</span>
        </button>
        <button id="restartBtn" class="btn btn-secondary btn-small">
          üîÑ <span data-i18n="restart">Neustart</span>
        </button>
      </div>
    </div>

    <div id="screenHighscore" class="card hidden">
      <h2 class="fun-font" style="text-align:center; margin-bottom:15px;">üèÜ Hall of Fame</h2>
      <ul id="highscoreList" class="highscore-list">
        </ul>
      <p id="noScoresMsg" style="text-align:center; color:var(--muted);" class="hidden">- Leer -</p>
      
      <button id="closeHighscoreBtn" class="btn btn-primary" style="margin-top:20px;">
        <i class="fa-solid fa-arrow-left"></i> <span data-i18n="back">Zur√ºck</span>
      </button>
    </div>

  </div>

  <div id="overlayHandoff" class="overlay">
    <div class="modal">
      <i class="modal-icon fa-solid fa-clock" style="color:var(--fun-blue)"></i>
      <h2 class="modal-title fun-font" data-i18n="roundStart">Runde startet!</h2>
      <p style="font-size:1.2rem; margin-bottom:20px;">
        <span data-i18n="readyMsg">Bist du bereit?</span><br>
        <b id="nextPlayerName" style="color:var(--primary); font-size:1.6rem;">...</b>
      </p>
      <button id="handoffOk" class="btn btn-primary">
        <i class="fa-solid fa-play"></i> GO!
      </button>
    </div>
  </div>

  <div id="overlayHelp" class="overlay">
    <div class="modal">
      <div id="helpEmojiDisplay" class="help-emoji-display">ü§î</div>
      <p id="helpContent" style="font-size:1.3rem; font-weight:800; margin: 10px 0; color:var(--dark);">...</p>
      <button id="helpOk" class="btn btn-warning">OK</button>
    </div>
  </div>

  <div id="overlayConfirm" class="overlay">
    <div class="modal">
      <h2 class="modal-title fun-font">Sicher?</h2>
      <p data-i18n="confirmMsg">Spiel beenden?</p>
      <div class="grid-2">
        <button id="confirmYes" class="btn btn-danger" data-i18n="yes">Ja</button>
        <button id="confirmNo" class="btn btn-secondary" data-i18n="no">Nein</button>
      </div>
    </div>
  </div>

  <div id="overlayTimeUp" class="overlay">
    <div class="modal">
      <h2 class="modal-title fun-font" style="color:var(--danger)">Zeit um! ‚è∞</h2>
      <p style="font-size:1.1rem; color:var(--muted);">In dieser Runde:</p>
      <div id="roundScoreDisplay" class="round-score-big">+0</div>
      <p style="font-size:1.1rem;">Punkte!</p>
      <button id="timeUpOk" class="btn btn-primary">Weiter</button>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      
      /* --- DATENBANK --- */
      const WORDS = {
        de: {
          leicht: [
            {t:"Hund", e:"üê∂"}, {t:"Katze", e:"üê±"}, {t:"Pizza", e:"üçï"}, {t:"Auto", e:"üöó"}, 
            {t:"Sonne", e:"‚òÄÔ∏è"}, {t:"Apfel", e:"üçé"}, {t:"Buch", e:"üìñ"}, {t:"Ball", e:"‚öΩ"},
            {t:"Blume", e:"üå∏"}, {t:"Baum", e:"üå≥"}, {t:"Eis", e:"üç¶"}, {t:"Haus", e:"üè†"},
            {t:"Fisch", e:"üêü"}, {t:"Mond", e:"üåô"}, {t:"Schule", e:"üè´"}, {t:"Stuhl", e:"ü™ë"},
            {t:"Bett", e:"üõèÔ∏è"}, {t:"Vogel", e:"üê¶"}, {t:"Uhr", e:"‚åö"}, {t:"Brille", e:"üëì"},
            {t:"laufen", e:"üèÉ"}, {t:"schlafen", e:"üò¥"}, {t:"essen", e:"üçΩÔ∏è"}, {t:"trinken", e:"ü•§"},
            {t:"singen", e:"üé§"}, {t:"malen", e:"üé®"}, {t:"lachen", e:"üòÜ"}, {t:"weinen", e:"üò≠"},
            {t:"springen", e:"ü¶ò"}, {t:"schwimmen", e:"üèä"}, {t:"lesen", e:"üìñ"}, {t:"schreiben", e:"‚úçÔ∏è"},
            {t:"schnell", e:"‚ö°"}, {t:"langsam", e:"üêå"}, {t:"gro√ü", e:"üêò"}, {t:"klein", e:"üêú"},
            {t:"hei√ü", e:"üî•"}, {t:"kalt", e:"‚ùÑÔ∏è"}, {t:"bunt", e:"üåà"}, {t:"laut", e:"üîä"}
          ],
          mittel: [
            {t:"Einhorn", e:"ü¶Ñ"}, {t:"Vampir", e:"üßõ"}, {t:"Pirat", e:"üè¥‚Äç‚ò†Ô∏è"}, {t:"Dschungel", e:"üå¥"},
            {t:"Rakete", e:"üöÄ"}, {t:"K√∂nig", e:"üëë"}, {t:"Geist", e:"üëª"}, {t:"Roboter", e:"ü§ñ"},
            {t:"Vulkan", e:"üåã"}, {t:"Insel", e:"üèùÔ∏è"}, {t:"Zirkus", e:"üé™"}, {t:"Drache", e:"üêâ"},
            {t:"Detektiv", e:"üïµÔ∏è"}, {t:"Kamera", e:"üì∑"}, {t:"Koffer", e:"üß≥"}, {t:"Geschenk", e:"üéÅ"},
            {t:"Schl√ºssel", e:"üîë"}, {t:"Br√ºcke", e:"üåâ"}, {t:"Krankenhaus", e:"üè•"}, {t:"Feuerwehr", e:"üöí"},
            {t:"verstecken", e:"ü´£"}, {t:"suchen", e:"üîç"}, {t:"kochen", e:"üç≥"}, {t:"reparieren", e:"üîß"},
            {t:"reisen", e:"‚úàÔ∏è"}, {t:"telefonieren", e:"üìû"}, {t:"gewinnen", e:"üèÜ"}, {t:"verlieren", e:"üòû"},
            {t:"heiraten", e:"üíç"}, {t:"streiten", e:"üò†"}, {t:"tr√§umen", e:"üí≠"}, {t:"fl√ºstern", e:"ü§´"},
            {t:"mutig", e:"ü¶Å"}, {t:"feige", e:"üêî"}, {t:"schlau", e:"üß†"}, {t:"dumm", e:"ü§™"},
            {t:"teuer", e:"üíé"}, {t:"billig", e:"üè∑Ô∏è"}, {t:"gesund", e:"ü•ó"}, {t:"krank", e:"ü§í"}
          ],
          schwer: [
            {t:"Demokratie", e:"üó≥Ô∏è"}, {t:"Freiheit", e:"üïäÔ∏è"}, {t:"Gerechtigkeit", e:"‚öñÔ∏è"}, {t:"Philosophie", e:"ü§î"},
            {t:"Universum", e:"üåå"}, {t:"Mikroskop", e:"üî¨"}, {t:"Verantwortung", e:"üíº"}, {t:"Geduld", e:"‚è≥"},
            {t:"Eifersucht", e:"üíö"}, {t:"Neugier", e:"üßê"}, {t:"Tradition", e:"üèÆ"}, {t:"Zukunft", e:"üîÆ"},
            {t:"Energie", e:"‚ö°"}, {t:"Klima", e:"üåç"}, {t:"Internet", e:"üåê"}, {t:"Geheimnis", e:"ü§ê"},
            {t:"diskutieren", e:"üó£Ô∏è"}, {t:"organisieren", e:"üìÖ"}, {t:"erfinden", e:"üí°"}, {t:"analysieren", e:"üìä"},
            {t:"kritisieren", e:"üëé"}, {t:"motivieren", e:"üëè"}, {t:"demonstrieren", e:"ü™ß"}, {t:"verhandeln", e:"ü§ù"},
            {t:"ignorieren", e:"üôà"}, {t:"respektieren", e:"üôá"}, {t:"garantieren", e:"üõ°Ô∏è"}, {t:"konzentrieren", e:"üéØ"},
            {t:"kompliziert", e:"üß©"}, {t:"unsichtbar", e:"ü´•"}, {t:"gef√§hrlich", e:"‚ö†Ô∏è"}, {t:"notwendig", e:"‚ùó"},
            {t:"typisch", e:"üè∑Ô∏è"}, {t:"offiziell", e:"üëî"}, {t:"k√ºnstlich", e:"ü§ñ"}, {t:"spontan", e:"‚ö°"}
          ]
        },
        it: {
          leicht: [
            {t:"Cane", e:"üê∂"}, {t:"Gatto", e:"üê±"}, {t:"Pizza", e:"üçï"}, {t:"Macchina", e:"üöó"},
            {t:"Sole", e:"‚òÄÔ∏è"}, {t:"Mela", e:"üçé"}, {t:"Libro", e:"üìñ"}, {t:"Palla", e:"‚öΩ"},
            {t:"Fiore", e:"üå∏"}, {t:"Albero", e:"üå≥"}, {t:"Gelato", e:"üç¶"}, {t:"Casa", e:"üè†"},
            {t:"Pesce", e:"üêü"}, {t:"Luna", e:"üåô"}, {t:"Scuola", e:"üè´"}, {t:"Sedia", e:"ü™ë"},
            {t:"Letto", e:"üõèÔ∏è"}, {t:"Uccello", e:"üê¶"}, {t:"Orologio", e:"‚åö"}, {t:"Occhiali", e:"üëì"},
            {t:"correre", e:"üèÉ"}, {t:"dormire", e:"üò¥"}, {t:"mangiare", e:"üçΩÔ∏è"}, {t:"bere", e:"ü•§"},
            {t:"cantare", e:"üé§"}, {t:"dipingere", e:"üé®"}, {t:"ridere", e:"üòÜ"}, {t:"piangere", e:"üò≠"},
            {t:"saltare", e:"ü¶ò"}, {t:"nuotare", e:"üèä"}, {t:"leggere", e:"üìñ"}, {t:"scrivere", e:"‚úçÔ∏è"},
            {t:"veloce", e:"‚ö°"}, {t:"lento", e:"üêå"}, {t:"grande", e:"üêò"}, {t:"piccolo", e:"üêú"},
            {t:"caldo", e:"üî•"}, {t:"freddo", e:"‚ùÑÔ∏è"}, {t:"colorato", e:"üåà"}, {t:"rumoroso", e:"üîä"}
          ],
          mittel: [
            {t:"Unicorno", e:"ü¶Ñ"}, {t:"Vampiro", e:"üßõ"}, {t:"Pirata", e:"üè¥‚Äç‚ò†Ô∏è"}, {t:"Giungla", e:"üå¥"},
            {t:"Razzo", e:"üöÄ"}, {t:"Re", e:"üëë"}, {t:"Fantasma", e:"üëª"}, {t:"Robot", e:"ü§ñ"},
            {t:"Vulcano", e:"üåã"}, {t:"Isola", e:"üèùÔ∏è"}, {t:"Circo", e:"üé™"}, {t:"Drago", e:"üêâ"},
            {t:"Detective", e:"üïµÔ∏è"}, {t:"Fotocamera", e:"üì∑"}, {t:"Valigia", e:"üß≥"}, {t:"Regalo", e:"üéÅ"},
            {t:"Chiave", e:"üîë"}, {t:"Ponte", e:"üåâ"}, {t:"Ospedale", e:"üè•"}, {t:"Pompieri", e:"üöí"},
            {t:"nascondersi", e:"ü´£"}, {t:"cercare", e:"üîç"}, {t:"cucinare", e:"üç≥"}, {t:"riparare", e:"üîß"},
            {t:"viaggiare", e:"‚úàÔ∏è"}, {t:"telefonare", e:"üìû"}, {t:"vincere", e:"üèÜ"}, {t:"perdere", e:"üòû"},
            {t:"sposarsi", e:"üíç"}, {t:"litigare", e:"üò†"}, {t:"sognare", e:"üí≠"}, {t:"bisbigliare", e:"ü§´"},
            {t:"coraggioso", e:"ü¶Å"}, {t:"codardo", e:"üêî"}, {t:"furbo", e:"üß†"}, {t:"stupido", e:"ü§™"},
            {t:"costoso", e:"üíé"}, {t:"economico", e:"üè∑Ô∏è"}, {t:"sano", e:"ü•ó"}, {t:"malato", e:"ü§í"}
          ],
          schwer: [
            {t:"Democrazia", e:"üó≥Ô∏è"}, {t:"Libert√†", e:"üïäÔ∏è"}, {t:"Giustizia", e:"‚öñÔ∏è"}, {t:"Filosofia", e:"ü§î"},
            {t:"Universo", e:"üåå"}, {t:"Mikroskop", e:"üî¨"}, {t:"Responsabilit√†", e:"üíº"}, {t:"Pazienza", e:"‚è≥"},
            {t:"Gelosia", e:"üíö"}, {t:"Curiosit√†", e:"üßê"}, {t:"Tradizione", e:"üèÆ"}, {t:"Futuro", e:"üîÆ"},
            {t:"Energia", e:"‚ö°"}, {t:"Clima", e:"üåç"}, {t:"Internet", e:"üåê"}, {t:"Segreto", e:"ü§ê"},
            {t:"discutere", e:"üó£Ô∏è"}, {t:"organizzare", e:"üìÖ"}, {t:"inventare", e:"üí°"}, {t:"analizzare", e:"üìä"},
            {t:"criticare", e:"üëé"}, {t:"motivare", e:"üëè"}, {t:"dimostrare", e:"ü™ß"}, {t:"negoziare", e:"ü§ù"},
            {t:"ignorare", e:"üôà"}, {t:"rispettare", e:"üôá"}, {t:"garantire", e:"üõ°Ô∏è"}, {t:"concentrarsi", e:"üéØ"},
            {t:"complicato", e:"üß©"}, {t:"invisibile", e:"ü´•"}, {t:"pericoloso", e:"‚ö†Ô∏è"}, {t:"necessario", e:"‚ùó"},
            {t:"tipico", e:"üè∑Ô∏è"}, {t:"ufficiale", e:"üëî"}, {t:"artificiale", e:"ü§ñ"}, {t:"spontaneo", e:"‚ö°"}
          ]
        }
      };

      const TRANSLATIONS = {
        de: {
          p1: "Spieler 1", p2: "Spieler 2", difficulty: "Schwierigkeit",
          easy: "Leicht (Kinder)", medium: "Mittel (Witzig)", hard: "Schwer (Knifflig)",
          start: "Los geht's", btnHighscore: "Highscore",
          turn: "Jetzt dran:", reveal: "Aufdecken", hint: "Tipp",
          correct: "JA!", wrong: "", finish: "Werten & Ende", restart: "Neustart",
          back: "Zur√ºck", roundStart: "Runde startet!", readyMsg: "Bereit f√ºr 2 Minuten?",
          confirmMsg: "Willst du das Spiel wirklich beenden?", yes: "Ja, weg damit", no: "Nein, zur√ºck",
          warrior: "Krieger", mage: "Magier", rogue: "Schurke", bard: "Barde", healer: "Heiler",
          ready: "Bereit?", hidden: "Wort versteckt", explain: "Erkl√§re das Wort!", itsA: "Es ist: "
        },
        it: {
          p1: "Giocatore 1", p2: "Giocatore 2", difficulty: "Difficolt√†",
          easy: "Facile (Bambini)", medium: "Medio (Divertente)", hard: "Difficile (Esperti)",
          start: "Inizia", btnHighscore: "Classifica",
          turn: "Tocca a:", reveal: "Rivela", hint: "Indizio",
          correct: "S√å!", wrong: "", finish: "Finito & Punti", restart: "Ricomincia",
          back: "Indietro", roundStart: "Inizia il round!", readyMsg: "Pronto per 2 minuti?",
          confirmMsg: "Vuoi davvero uscire dal gioco?", yes: "S√¨, cancella", no: "No, torna",
          warrior: "Guerriero", mage: "Mago", rogue: "Ladro", bard: "Bardo", healer: "Guaritore",
          ready: "Pronto?", hidden: "Parola nascosta", explain: "Spiega la parola!", itsA: "√à: "
        }
      };

      const CLASSES = {
        warrior: "‚öîÔ∏è", mage: "ü™Ñ", rogue: "üó°Ô∏è", bard: "üéµ", healer: "üåø"
      };

      /* --- STATE & STORAGE --- */
      let state = {
        lang: 'de',
        screen: 'lang', 
        players: [],
        currentPIdx: 0,
        difficulty: 'mittel',
        score: 0,
        roundScore: 0, // NEU: Punkte nur f√ºr diese Runde
        currentWord: null,
        revealed: false,
        helpUsed: false,
        deck: [],
        timeLeft: 120, 
        isRoundActive: false
      };

      let timerInterval = null;
      let highscores = JSON.parse(localStorage.getItem('wordy_highscores_v4') || "[]");

      /* --- HELPER --- */
      function get(id) { return document.getElementById(id); }
      function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }
      
      /* --- NAVIGATION --- */
      function showScreen(screenId) {
        ['screenLanguage', 'screenSettings', 'screenGame', 'screenHighscore'].forEach(id => get(id).classList.add('hidden'));
        get(screenId).classList.remove('hidden');
        state.screen = screenId.replace('screen', '').toLowerCase();
        saveGame();
      }

      window.setLanguage = (lang) => {
        state.lang = lang;
        applyLanguage();
        // Check Savegame
        const saved = localStorage.getItem('wordy_save_v4');
        if(saved) {
          try {
            const parsed = JSON.parse(saved);
            if(parsed.screen === 'game'){
              Object.assign(state, parsed);
              restoreGame();
              return;
            }
          } catch(e) { localStorage.removeItem('wordy_save_v4'); }
        }
        showScreen('screenSettings');
      };

      function applyLanguage() {
        const t = TRANSLATIONS[state.lang];
        document.querySelectorAll('[data-i18n]').forEach(el => {
          const key = el.getAttribute('data-i18n');
          if(t[key]) el.textContent = t[key];
        });
        get('difficulty').options[0].text = t.easy;
        get('difficulty').options[1].text = t.medium;
        get('difficulty').options[2].text = t.hard;
      }

      /* --- GAME LOGIC --- */
      function startGame() {
        const p1Name = get('p1name').value.trim() || (state.lang === 'de' ? "Spieler 1" : "Giocatore 1");
        const p2Name = get('p2name').value.trim();
        const p1Class = get('p1class').value;
        const p2Class = get('p2class').value;

        state.players = [{ name: p1Name, class: p1Class, pts: 0 }];
        if(p2Name) state.players.push({ name: p2Name, class: p2Class, pts: 0 });
        
        state.currentPIdx = 0;
        state.difficulty = get('difficulty').value;
        state.score = 0;
        state.deck = shuffle([...WORDS[state.lang][state.difficulty]]);
        
        // Reset
        state.timeLeft = 120;
        state.isRoundActive = false;
        state.roundScore = 0;

        updateUI();
        updateTimerDisplay();
        showScreen('screenGame');
        showRoundOverlay();
      }

      function showRoundOverlay() {
        const p = state.players[state.currentPIdx];
        get('nextPlayerName').textContent = p.name;
        get('overlayHandoff').classList.add('active');
        state.isRoundActive = false;
        state.roundScore = 0; // Reset f√ºr neue Runde
        clearInterval(timerInterval);
        
        // N√§chstes Wort schon vorbereiten aber noch nicht zeigen (Overlay ist davor)
        // Sobald Overlay weggeht, ist es sichtbar
        if(state.deck.length === 0) state.deck = shuffle([...WORDS[state.lang][state.difficulty]]);
        state.currentWord = state.deck.pop();
        state.revealed = true; // AUTO REVEAL!
        state.helpUsed = false;
        updateUI();
      }

      function startRound() {
        get('overlayHandoff').classList.remove('active');
        state.timeLeft = 120;
        state.isRoundActive = true;
        updateTimerDisplay();
        
        timerInterval = setInterval(() => {
          if(state.timeLeft > 0) {
            state.timeLeft--;
            updateTimerDisplay();
          } else {
            endRound();
          }
          saveGame();
        }, 1000);
      }

      function endRound() {
        clearInterval(timerInterval);
        state.isRoundActive = false;
        
        // Round Summary Update
        const sign = state.roundScore >= 0 ? "+" : "";
        get('roundScoreDisplay').textContent = `${sign}${state.roundScore}`;
        
        get('overlayTimeUp').classList.add('active');
      }

      function nextPlayerOrRound() {
        get('overlayTimeUp').classList.remove('active');
        if(state.players.length > 1) {
            state.currentPIdx = (state.currentPIdx + 1) % state.players.length;
        }
        showRoundOverlay();
      }

      function nextWord(autoReveal = true) {
        if(state.deck.length === 0) {
          state.deck = shuffle([...WORDS[state.lang][state.difficulty]]);
        }
        state.currentWord = state.deck.pop();
        state.revealed = autoReveal; 
        state.helpUsed = false;
        saveGame();
        updateUI();
      }

      function handleResult(correct) {
        if(!state.isRoundActive) return;

        const p = state.players[state.currentPIdx];
        if(correct) {
          p.pts += 1;
          state.score += 1; 
          state.roundScore += 1; // Runden-Tracker
          burstConfetti();
        }
        
        // Sofort weiter
        nextWord(true);
      }

      function updateTimerDisplay() {
        const m = Math.floor(state.timeLeft / 60);
        const s = state.timeLeft % 60;
        const txt = `0${m}:${s < 10 ? '0'+s : s}`;
        const el = get('timerDisplay');
        el.textContent = txt;
        
        if(state.timeLeft <= 10) el.classList.add('timer-warning');
        else el.classList.remove('timer-warning');
      }

      function updateUI() {
        const t = TRANSLATIONS[state.lang];
        const p = state.players[state.currentPIdx];
        
        get('turnIcon').textContent = CLASSES[p.class];
        get('turnName').textContent = p.name;
        
        // Auto Reveal Logic: Wenn Timer l√§uft, ist es immer revealed
        if(state.revealed) {
            get('wordHint').textContent = t.explain;
            get('wordText').textContent = state.currentWord.t;
        } else {
            // Fallback (eigentlich nicht erreichbar in Time Attack)
            get('wordHint').textContent = t.ready;
            get('wordText').textContent = "...";
        }

        const p1 = state.players[0];
        get('iconP1').textContent = CLASSES[p1.class];
        get('nameP1').textContent = p1.name;
        get('ptsP1').textContent = p1.pts;

        if(state.players.length > 1) {
          const p2 = state.players[1];
          get('scoreRow2').classList.remove('hidden');
          get('iconP2').textContent = CLASSES[p2.class];
          get('nameP2').textContent = p2.name;
          get('ptsP2').textContent = p2.pts;
        } else {
          get('scoreRow2').classList.add('hidden');
        }
      }

      /* --- SAVING --- */
      function saveGame() {
        const saveState = {...state};
        localStorage.setItem('wordy_save_v4', JSON.stringify(saveState));
      }

      function restoreGame() {
        applyLanguage();
        updateUI();
        updateTimerDisplay();
        showScreen('screenGame');
        if(state.isRoundActive) showRoundOverlay(); // Pause bei Reload
      }

      function finishGame() {
        clearInterval(timerInterval);
        const date = new Date().toLocaleDateString();
        let nameStr = state.players[0].name;
        if(state.players.length > 1) nameStr += " & " + state.players[1].name;
        
        highscores.unshift({ date: date, names: nameStr, score: state.score });
        highscores = highscores.slice(0, 10);
        localStorage.setItem('wordy_highscores_v4', JSON.stringify(highscores));
        localStorage.removeItem('wordy_save_v4');
        showHighscore();
      }

      function showHighscore() {
        const list = get('highscoreList');
        list.innerHTML = "";
        if(highscores.length === 0) get('noScoresMsg').classList.remove('hidden');
        else {
          get('noScoresMsg').classList.add('hidden');
          highscores.forEach(h => {
            const li = document.createElement('li');
            li.className = "highscore-entry";
            li.innerHTML = `<div><span class="hs-date">${h.date}</span><span class="hs-names">${h.names}</span></div><div class="hs-score">${h.score}</div>`;
            list.appendChild(li);
          });
        }
        showScreen('screenHighscore');
      }

      /* --- EVENTS --- */
      get('startBtn').onclick = startGame;
      // Reveal Button entfernt
      get('correctBtn').onclick = () => handleResult(true);
      get('wrongBtn').onclick = () => handleResult(false);
      
      get('helpBtn').onclick = () => {
        state.helpUsed = true;
        const t = TRANSLATIONS[state.lang];
        get('helpEmojiDisplay').textContent = state.currentWord.e;
        get('helpContent').textContent = t.itsA + state.currentWord.t;
        get('overlayHelp').classList.add('active');
      };

      get('handoffOk').onclick = startRound;
      get('timeUpOk').onclick = nextPlayerOrRound;
      get('helpOk').onclick = () => get('overlayHelp').classList.remove('active');

      let pendingAction = null;
      get('restartBtn').onclick = () => { pendingAction = 'restart'; get('overlayConfirm').classList.add('active'); };
      get('finishBtn').onclick = () => { pendingAction = 'finish'; get('overlayConfirm').classList.add('active'); };

      get('confirmYes').onclick = () => {
        get('overlayConfirm').classList.remove('active');
        if(pendingAction === 'restart') {
          localStorage.removeItem('wordy_save_v4');
          location.reload(); 
        } else if(pendingAction === 'finish') finishGame();
      };
      get('confirmNo').onclick = () => get('overlayConfirm').classList.remove('active');

      get('showHighscoreBtn').onclick = showHighscore;
      get('closeHighscoreBtn').onclick = () => {
        if(state.players.length > 0 && localStorage.getItem('wordy_save_v4')) showScreen('screenGame');
        else showScreen('screenSettings');
      };

      function burstConfetti() {
        const c = get('confetti');
        const ctx = c.getContext('2d');
        c.width = window.innerWidth; c.height = window.innerHeight;
        let p = [];
        const colors = ['#a29bfe','#ff6b81','#2ed573','#ffeaa7', '#1e90ff'];
        for(let i=0; i<30; i++){
          p.push({
            x: c.width/2, y: c.height/2,
            vx: (Math.random()-0.5)*25, vy: (Math.random()-0.5)*25 - 5,
            color: colors[Math.floor(Math.random()*colors.length)],
            life: 1, size: Math.random()*10 + 5
          });
        }
        function draw(){
          ctx.clearRect(0,0,c.width,c.height);
          p.forEach((pt,i) => {
            pt.x += pt.vx; pt.y += pt.vy; pt.vy += 0.5; pt.life -= 0.05;
            ctx.fillStyle = pt.color; ctx.globalAlpha = Math.max(0, pt.life);
            ctx.beginPath(); ctx.arc(pt.x, pt.y, pt.size, 0, Math.PI*2); ctx.fill();
            if(pt.life <= 0) p.splice(i,1);
          });
          if(p.length > 0) requestAnimationFrame(draw);
        }
        draw();
      }

      // Check Init
      const saved = localStorage.getItem('wordy_save_v4');
      if(saved && JSON.parse(saved).screen === 'game') {
        state = JSON.parse(saved);
        applyLanguage();
        restoreGame();
      }
    });
  </script>
</body>
</html>
