<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wordy</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700;800&family=Nunito:wght@800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#0F172A; --muted:#64748B;
      --glass: rgba(255,255,255,.86);
      --shadow: 0 18px 50px rgba(15,23,42,.14);
      --shadow2: 0 10px 24px rgba(15,23,42,.10);
      --ring: 0 0 0 4px rgba(124,58,237,.18);

      --p1:#8B5CF6; --p2:#EC4899; --c1:#06B6D4;
      --good1:#16A34A; --good2:#22C55E;
      --bad1:#EF4444; --bad2:#F97316;
      --dark1:#111827; --dark2:#334155;
      --help1:#F59E0B; --help2:#F97316;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:"Nunito", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1100px 700px at 15% 10%, #FFE3F1 0%, transparent 55%),
        radial-gradient(950px 700px at 85% 25%, #D8F5FF 0%, transparent 58%),
        radial-gradient(900px 700px at 55% 95%, #E8FFE7 0%, transparent 55%),
        linear-gradient(180deg, #FFF7FB, #F2FBFF);
      min-height:100vh;
    }

    .wrap{ max-width:720px; margin:0 auto; padding:18px 14px 30px; }

    .brand{ text-align:center; margin:6px 0 10px; }
    .brand h1{
      margin:0;
      font-family:"Baloo 2","Nunito",system-ui,sans-serif;
      font-size:58px;
      line-height:1;
      font-weight:800;
      background: linear-gradient(135deg, var(--p1), var(--p2), var(--c1));
      -webkit-background-clip:text; background-clip:text; color:transparent;
      text-shadow: 0 10px 26px rgba(124,58,237,.10);
    }
    .brand p{ margin:8px 0 0; color:var(--muted); font-weight:900; font-size:14px; }

    .card{
      background: var(--glass);
      border: 2px solid rgba(255,255,255,.9);
      box-shadow: var(--shadow);
      border-radius: 28px;
      padding: 14px;
      backdrop-filter: blur(12px);
      position:relative;
      overflow:hidden;
    }
    .card::before, .card::after{
      content:"";
      position:absolute;
      width:190px; height:190px;
      border-radius: 40px;
      opacity:.22;
      pointer-events:none;
    }
    .card::before{
      right:-80px; top:-80px;
      background: radial-gradient(circle at 30% 30%, rgba(236,72,153,.70), rgba(139,92,246,.35), transparent 60%);
      transform: rotate(10deg);
    }
    .card::after{
      left:-85px; bottom:-85px;
      background: radial-gradient(circle at 40% 40%, rgba(34,197,94,.65), rgba(6,182,212,.35), transparent 60%);
      transform: rotate(-12deg);
    }

    .panel{
      background: rgba(255,255,255,.90);
      border-radius: 22px;
      padding: 12px;
      box-shadow: var(--shadow2);
      border: 1px solid rgba(15,23,42,.08);
      position:relative;
      z-index:1;
    }

    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:2px 0 8px;
      font-weight:1000;
      letter-spacing:.3px;
      text-transform: uppercase;
    }

    input, select, button{
      width:100%;
      font-size:16px;
      border-radius:18px;
      padding:14px 14px;
      font-family:"Nunito",system-ui,sans-serif;
    }

    input, select{
      background:#fff;
      border:2px solid rgba(15,23,42,.08);
      outline:none;
      box-shadow: 0 8px 18px rgba(15,23,42,.06);
    }
    input:focus, select:focus{ box-shadow: var(--ring); border-color: rgba(124,58,237,.35); }

    .row2{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    .grid2{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:12px; }
    .grid2tight{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px; }

    button{
      border:none; cursor:pointer;
      font-weight:1000;
      box-shadow: 0 14px 22px rgba(15,23,42,.14);
      position:relative; overflow:hidden;
      -webkit-tap-highlight-color: transparent;
      transition: transform .08s ease, filter .12s ease;
      z-index:1;
    }
    button:active{ transform: translateY(1px); }
    button:disabled{ opacity:.55; cursor:not-allowed; filter:saturate(.6); }
    button::after{
      content:"";
      position:absolute;
      inset:-40% -20% auto -20%;
      height:120%;
      background: linear-gradient(120deg, rgba(255,255,255,.0), rgba(255,255,255,.35), rgba(255,255,255,.0));
      transform: rotate(10deg);
      opacity:.65;
      pointer-events:none;
    }

    .btnPrimary{ background: linear-gradient(135deg, var(--p1), var(--p2)); color:white; }
    .btnDark{ background: linear-gradient(135deg, var(--dark1), var(--dark2)); color:white; }
    .btnWord{ background: linear-gradient(135deg, #06B6D4, #22C55E); color:white; }
    .btnGood{ background: linear-gradient(135deg, var(--good1), var(--good2)); color:white; }
    .btnBad{ background: linear-gradient(135deg, var(--bad1), var(--bad2)); color:white; }
    .btnHelp{ background: linear-gradient(135deg, var(--help1), var(--help2)); color:white; }

    .turnBig{
      margin-top:12px;
      border-radius: 26px;
      padding: 14px;
      background: rgba(255,255,255,.94);
      border: 5px solid rgba(124,58,237,.22);
      box-shadow: 0 18px 30px rgba(15,23,42,.12);
      text-align:center;
      position:relative;
      z-index:1;
    }
    .turnBig .small{
      font-size:12px;
      color:var(--muted);
      font-weight:1000;
      text-transform:uppercase;
      letter-spacing:.25px;
    }
    .turnBig .name{
      font-family:"Baloo 2","Nunito",system-ui,sans-serif;
      font-size:52px;
      font-weight:800;
      margin-top:4px;
      line-height:1.05;
    }

    .wordCard{
      margin-top:12px;
      border-radius:26px;
      padding:16px;
      background: rgba(255,255,255,.96);
      border: 2px dashed rgba(124,58,237,.28);
      box-shadow: 0 18px 34px rgba(15,23,42,.12);
      text-align:center;
      min-height: 190px;
      display:flex; flex-direction:column; justify-content:center; gap:10px;
      position:relative;
      z-index:1;
    }
    .wordHint{ font-size:13px; color:var(--muted); font-weight:1000; }
    .word{
      font-family:"Baloo 2","Nunito",system-ui,sans-serif;
      font-size:54px;
      font-weight:800;
      letter-spacing:-.4px;
      line-height:1.05;
      padding: 4px 6px;
    }

    .miniRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:6px;
    }

    .helpUsedTag{
      display:inline-block;
      margin-top:2px;
      font-size:12px;
      font-weight:1000;
      color:#9A3412;
      background: rgba(245,158,11,.18);
      border: 2px solid rgba(245,158,11,.20);
      border-radius: 999px;
      padding: 6px 10px;
    }

    .scores{
      margin-top:12px;
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      position:relative;
      z-index:1;
    }
    .scoreBox{
      background: rgba(255,255,255,.92);
      border: 2px solid rgba(15,23,42,.08);
      border-radius: 22px;
      padding: 12px 14px;
      box-shadow: var(--shadow2);
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
      flex-wrap:wrap;
    }
    .scoreBox .who{
      font-weight:1000;
      color: var(--ink);
      font-size:16px;
    }
    .scoreBox .meta{
      text-align:right;
      font-weight:1000;
      color: var(--ink);
    }
    .scoreBox .meta small{
      display:block;
      margin-top:4px;
      color: var(--muted);
      font-weight:1000;
    }

    /* Overlay Base */
    .overlay{
      position:fixed;
      inset:0;
      background: rgba(15,23,42,.45);
      backdrop-filter: blur(10px);
      z-index: 20000;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
    }
    .overlay.show{ display:flex; }
    .overlayCard{
      width: min(680px, 100%);
      background: rgba(255,255,255,.97);
      border-radius: 32px;
      box-shadow: 0 28px 90px rgba(15,23,42,.35);
      padding: 20px;
      text-align:center;
      border: 3px solid rgba(255,255,255,.9);
    }

    /* √úbergabe */
    .handoffHero{
      border-radius: 28px;
      padding: 18px 14px;
      background:
        radial-gradient(260px 200px at 25% 25%, rgba(139,92,246,.18), transparent 60%),
        radial-gradient(260px 200px at 75% 30%, rgba(236,72,153,.18), transparent 60%),
        radial-gradient(260px 200px at 50% 85%, rgba(6,182,212,.16), transparent 60%),
        rgba(255,255,255,.92);
      border: 2px solid rgba(124,58,237,.18);
      box-shadow: 0 14px 26px rgba(15,23,42,.10);
      margin-bottom: 14px;
    }
    .handoffEmoji{ font-size: 56px; line-height: 1; margin: 6px 0 10px; }
    .handoffTitle{
      font-family:"Baloo 2","Nunito",system-ui,sans-serif;
      font-size: 40px;
      font-weight: 800;
      line-height: 1.05;
      margin: 0 0 6px;
    }
    .handoffTiny{
      color: var(--muted);
      font-weight: 1000;
      font-size: 14px;
      margin: 0;
    }
    .handoffName{
      font-family:"Baloo 2","Nunito",system-ui,sans-serif;
      font-size: 56px;
      font-weight: 800;
      line-height: 1.0;
      margin: 12px 0 6px;
      padding: 8px 10px;
      border-radius: 22px;
      background: rgba(255,255,255,.95);
      border: 2px dashed rgba(124,58,237,.28);
      box-shadow: 0 10px 20px rgba(15,23,42,.08);
    }
    .handoffArrowRow{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 14px;
      margin: 12px 0 12px;
      flex-wrap: wrap;
    }
    .handoffArrowRow .bubble{
      display:grid;
      place-items:center;
      width: 86px;
      height: 86px;
      border-radius: 24px;
      background: rgba(124,58,237,.10);
      border: 2px solid rgba(124,58,237,.18);
      font-size: 44px;
      box-shadow: 0 12px 18px rgba(15,23,42,.08);
    }

    /* Hilfe Overlay */
    .helpEmoji{ font-size: 44px; margin-bottom: 6px; }
    .helpTitle{
      font-family:"Baloo 2","Nunito",system-ui,sans-serif;
      font-size: 34px;
      font-weight: 800;
      margin: 0 0 8px;
    }
    .helpText{
      font-size:18px;
      font-weight:900;
      color: var(--ink);
      line-height:1.25;
      background: rgba(245,158,11,.14);
      border: 2px solid rgba(245,158,11,.20);
      border-radius: 22px;
      padding: 14px 14px;
      box-shadow: var(--shadow2);
      margin: 0 0 14px;
      text-align:left;
    }
    .helpNote{
      margin: 0 0 14px;
      color: var(--muted);
      font-weight: 1000;
      font-size: 14px;
    }

    /* LevelUp */
    .levelEmoji{ font-size: 44px; margin-bottom: 6px; }
    .levelTitle{
      font-family:"Baloo 2","Nunito",system-ui,sans-serif;
      font-size: 36px;
      font-weight: 800;
      margin: 0 0 8px;
    }
    .levelBig{
      font-family:"Baloo 2","Nunito",system-ui,sans-serif;
      font-size: 56px;
      font-weight: 800;
      line-height: 1.0;
      margin: 8px 0 8px;
      background: linear-gradient(135deg, var(--p1), var(--p2), var(--c1));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .levelSub{
      color: var(--muted);
      font-weight: 1000;
      font-size: 16px;
      margin: 0 0 14px;
    }

    .btnXL{
      border-radius: 26px !important;
      padding: 18px 18px !important;
      font-size: 22px !important;
      font-weight: 1000 !important;
      box-shadow: 0 18px 28px rgba(15,23,42,.18) !important;
    }

    /* Konfetti */
    #confetti{
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 25000;
    }
    .confetto{
      position:absolute;
      top:-20px;
      width:10px;
      height:14px;
      border-radius:3px;
      opacity:.95;
      animation: fall var(--dur) linear forwards;
      transform: translateX(var(--x)) rotate(var(--r));
      filter: drop-shadow(0 6px 10px rgba(31,41,55,.12));
    }
    @keyframes fall{
      to{
        transform: translateX(var(--x2)) translateY(110vh) rotate(calc(var(--r) + 540deg));
        opacity: 1;
      }
    }

    @media (max-width: 420px){
      .turnBig .name{ font-size:46px; }
      .word{ font-size:48px; }
      .handoffTitle{ font-size: 34px; }
      .handoffName{ font-size: 46px; }
      .handoffEmoji{ font-size: 50px; }
      .handoffArrowRow .bubble{ width: 76px; height: 76px; font-size: 40px; }
      .btnXL{ font-size: 20px !important; }
      .levelBig{ font-size: 46px; }
      .helpText{ font-size: 17px; }
      .miniRow{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <div id="confetti" aria-hidden="true"></div>

  <!-- √úbergabe -->
  <div class="overlay" id="handoff">
    <div class="overlayCard">
      <div class="handoffHero">
        <div class="handoffEmoji">üì±‚û°Ô∏è</div>
        <div class="handoffTitle">Jetzt bist du dran!</div>
        <p class="handoffTiny">Handy weitergeben</p>
      </div>

      <div class="handoffName" id="handoffName">Spieler</div>

      <div class="handoffArrowRow" aria-hidden="true">
        <div class="bubble">üôà</div>
        <div class="bubble">ü§´</div>
        <div class="bubble">‚ú®</div>
      </div>

      <p class="handoffTiny" id="handoffText" style="margin-bottom:14px;">
        Dr√ºck dann auf ‚ÄûOK‚Äú.
      </p>

      <button class="btnPrimary btnXL" id="handoffOk" type="button">OK!</button>
    </div>
  </div>

  <!-- Hilfe -->
  <div class="overlay" id="helpOverlay">
    <div class="overlayCard">
      <div class="helpEmoji">üí°</div>
      <div class="helpTitle">Kleiner Tipp</div>
      <div class="helpText" id="helpText">‚Ä¶</div>
      <p class="helpNote">Wenn du Hilfe nutzt, z√§hlt ‚ÄûRichtig‚Äú nur <b>+0,5</b> Punkte.</p>
      <button class="btnHelp btnXL" id="helpOk" type="button">Okay!</button>
    </div>
  </div>

  <!-- Level Up -->
  <div class="overlay" id="levelup">
    <div class="overlayCard">
      <div class="levelEmoji">üéâüèÜ</div>
      <div class="levelTitle">Neuer Titel!</div>
      <div class="levelBig" id="levelupBig">Mia</div>
      <p class="levelSub" id="levelupText">ist jetzt: Autor</p>
      <button class="btnPrimary btnXL" id="levelupOk" type="button">Weiter</button>
    </div>
  </div>

  <div class="wrap">
    <div class="brand">
      <h1>Wordy</h1>
      <p>Start ‚Üí (weitergeben) ‚Üí Wort anzeigen ‚Üí Hilfe? ‚Üí richtig/falsch</p>
    </div>

    <div class="card">
      <div class="panel">
        <div class="row2">
          <div>
            <label for="p1name">Name Spieler 1</label>
            <input id="p1name" type="text" placeholder="z. B. Mia" maxlength="18" />
          </div>
          <div>
            <label for="p2name">Name Spieler 2</label>
            <input id="p2name" type="text" placeholder="leer = 1 Spieler" maxlength="18" />
          </div>
        </div>

        <div class="row2" style="margin-top:12px;">
          <div>
            <label for="difficulty">Schwierigkeitsgrad</label>
            <select id="difficulty">
              <option value="leicht" selected>Leicht</option>
              <option value="mittel">Mittel</option>
              <option value="schwer">Schwer</option>
            </select>
          </div>
          <div>
            <label for="type">Wortart</label>
            <select id="type">
              <option value="all" selected>Alles</option>
              <option value="nomen">Nomen</option>
              <option value="verb">Verb</option>
              <option value="adj">Adjektiv</option>
            </select>
          </div>
        </div>

        <div class="grid2">
          <button id="startBtn" class="btnPrimary" type="button">Start</button>
          <button id="restartBtn" class="btnDark" type="button">Neues Spiel</button>
        </div>
      </div>

      <div id="turnBox" class="turnBig" style="display:none;">
        <div class="small">Jetzt dran</div>
        <div class="name" id="turnName">‚Äî</div>
      </div>

      <div class="wordCard">
        <div class="wordHint" id="wordHint">Dr√ºck Start üòä</div>
        <div class="word" id="word">‚Äî</div>

        <div class="miniRow">
          <button id="revealBtn" class="btnWord" type="button" disabled>Wort anzeigen</button>
          <button id="helpBtn" class="btnHelp" type="button" disabled>Hilfe üí°</button>
        </div>

        <div id="helpUsedTag" class="helpUsedTag" style="display:none;">Hilfe genutzt ‚Üí ‚ÄûRichtig‚Äú = +0,5</div>
      </div>

      <div class="scores">
        <div class="scoreBox" id="scoreBox1">
          <div class="who" id="who1">Spieler 1</div>
          <div class="meta">
            <div id="pts1">Punkte: 0</div>
            <small id="title1">Titel: Anf√§nger</small>
          </div>
        </div>

        <div class="scoreBox" id="scoreBox2" style="display:none;">
          <div class="who" id="who2">Spieler 2</div>
          <div class="meta">
            <div id="pts2">Punkte: 0</div>
            <small id="title2">Titel: Anf√§nger</small>
          </div>
        </div>
      </div>

      <div class="grid2tight">
        <button id="rightBtn" class="btnGood" type="button" disabled>Richtig</button>
        <button id="wrongBtn" class="btnBad" type="button" disabled>Falsch</button>
      </div>
    </div>
  </div>

  <script>
    /*********************
     *  Daten
     *********************/
    const TITLES = ["Anf√§nger","Autor","Erz√§hler","Wortmeister","Sprachheld","Legende","Mythos","Sternenschreiber"];

    const WORDS = {
      leicht: {
        nomen:["Apfel","Hund","Katze","Schule","Buch","Ball","Auto","Blume","Baum","Haus","Eis","Brot","Tisch","Stuhl","Sonne","Mond","Wolke","Fisch","Zug","Schuh"],
        verb:["laufen","springen","lesen","malen","lachen","essen","trinken","spielen","singen","tanzen","schlafen","rufen","sehen","h√∂ren","werfen","finden","bauen","winken","schwimmen","klettern"],
        adj:["bunt","schnell","gro√ü","klein","nett","laut","leise","warm","kalt","fr√∂hlich","weich","hart","rund","stark","schwach","neu","alt","hell","dunkel","s√º√ü"]
      },
      mittel: {
        nomen:["Abenteuer","Geheimnis","Regenbogen","Bibliothek","Schatzkarte","Kompass","Rakete","Roboter","Dschungel","Vulkan","Labyrinth","Mikroskop","Experiment","Pyramide","Wasserfall","Orchester","Troph√§e","Teamgeist","Zaubertrank","Zeitmaschine"],
        verb:["entdecken","verstecken","vergleichen","erkl√§ren","beobachten","erfinden","trainieren","√ºberzeugen","organisieren","reparieren","beschreiben","entscheiden","√ºberraschen","verbessern","planen","untersuchen","kombinieren","vermeiden","anfeuern","nachdenken"],
        adj:["neugierig","geheim","riesig","knifflig","tapfer","geduldig","vorsichtig","aufmerksam","mysteri√∂s","hilfsbereit","elegant","witzig","mutig","ruhig","wild","stolz","clever","magisch","seltsam","gl√§nzend"]
      },
      schwer: {
        nomen:["Gerechtigkeit","Verantwortung","Perspektive","Zusammenhang","Nachhaltigkeit","Bewusstsein","Zivilcourage","Argumentation","Diplomatie","Komplexit√§t","Konsequenz","Interpretation","Widerspruch","Ver√§nderung","Selbstvertrauen","Datenschutz","Filterblase","Biodiversit√§t","Klimawandel","Strategie"],
        verb:["reflektieren","argumentieren","interpretieren","analysieren","differenzieren","veranschaulichen","formulieren","hinterfragen","prognostizieren","strukturieren","priorisieren","kritisieren","moderieren","abstrahieren","konkretisieren","systematisieren","koordinieren","relativieren","implizieren","verhandeln"],
        adj:["ambivalent","konsequent","nachhaltig","subtil","kontrovers","komplex","pragmatisch","konstruktiv","authentisch","resilient","solidarisch","souver√§n","nuanciert","kritisch","innovativ","intuitiv","fragil","detailliert","autonom","neutral"]
      }
    };

    // Optionale, handgemachte Tipps (du kannst jederzeit erweitern)
    const HINTS = {
      "Apfel":"Obst. Rund. Oft rot oder gr√ºn. Man kann es essen.",
      "Hund":"Tier. Bellt. Ist oft ein Haustier.",
      "Katze":"Tier. Miaut. Hat Schnurrhaare.",
      "lesen":"Das macht man mit B√ºchern oder Texten.",
      "springen":"Man bewegt sich nach oben ‚Äì oft mit beiden F√º√üen.",
      "fr√∂hlich":"Wenn man gute Laune hat.",
      "Abenteuer":"Eine spannende Reise oder Geschichte.",
      "Roboter":"Eine Maschine, die Dinge automatisch macht.",
      "Zaubertrank":"Ein magisches Getr√§nk aus Geschichten.",
      "reflektieren":"√úber etwas nachdenken, was passiert ist."
    };

    /*********************
     *  UI
     *********************/
    const p1nameEl = document.getElementById("p1name");
    const p2nameEl = document.getElementById("p2name");
    const difficultyEl = document.getElementById("difficulty");
    const typeEl = document.getElementById("type");

    const startBtn = document.getElementById("startBtn");
    const restartBtn = document.getElementById("restartBtn");
    const revealBtn = document.getElementById("revealBtn");
    const helpBtn = document.getElementById("helpBtn");
    const rightBtn = document.getElementById("rightBtn");
    const wrongBtn = document.getElementById("wrongBtn");

    const turnBox = document.getElementById("turnBox");
    const turnNameEl = document.getElementById("turnName");
    const wordHintEl = document.getElementById("wordHint");
    const wordEl = document.getElementById("word");

    const who1 = document.getElementById("who1");
    const who2 = document.getElementById("who2");
    const pts1 = document.getElementById("pts1");
    const pts2 = document.getElementById("pts2");
    const title1 = document.getElementById("title1");
    const title2 = document.getElementById("title2");
    const scoreBox2 = document.getElementById("scoreBox2");

    const handoff = document.getElementById("handoff");
    const handoffNameEl = document.getElementById("handoffName");
    const handoffText = document.getElementById("handoffText");
    const handoffOk = document.getElementById("handoffOk");

    const helpOverlay = document.getElementById("helpOverlay");
    const helpTextEl = document.getElementById("helpText");
    const helpOk = document.getElementById("helpOk");
    const helpUsedTag = document.getElementById("helpUsedTag");

    const levelup = document.getElementById("levelup");
    const levelupBig = document.getElementById("levelupBig");
    const levelupText = document.getElementById("levelupText");
    const levelupOk = document.getElementById("levelupOk");

    const confettiLayer = document.getElementById("confetti");

    /*********************
     *  State
     *********************/
    let started = false;
    let twoPlayers = false;
    let name1 = "Spieler 1";
    let name2 = "Spieler 2";
    let currentPlayer = 1;

    let score1 = 0;
    let score2 = 0;
    let lastTitleIdx1 = 0;
    let lastTitleIdx2 = 0;

    let currentWord = null;
    let currentType = "all";
    let revealed = false;

    let usedHelpThisWord = false;

    const deck = {}; // key diff|type => {arr, idx}

    /*********************
     *  Helpers
     *********************/
    function fmtScore(n){
      // zeigt .5 sauber an, sonst ohne Nachkommastellen
      const isHalf = Math.abs(n * 2 - Math.round(n * 2)) < 1e-9 && Math.round(n * 2) % 2 === 1;
      if (isHalf) return n.toFixed(1).replace(".", ",");
      if (Number.isInteger(n)) return String(n);
      return n.toFixed(1).replace(".", ",");
    }

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }
    function getList(diff, type){
      const b = WORDS[diff];
      if(!b) return [];
      if(type==="all") return [...b.nomen, ...b.verb, ...b.adj];
      return b[type] || [];
    }
    function ensureDeck(diff, type){
      const key = diff + "|" + type;
      if(!deck[key] || deck[key].idx >= deck[key].arr.length){
        deck[key] = { arr: shuffle(getList(diff, type)), idx: 0 };
      }
      return key;
    }
    function titleFor(points){
      const idx = Math.max(0, Math.min(TITLES.length-1, Math.floor(points/5)));
      return { idx, title: TITLES[idx] };
    }

    function simpleFallbackHint(word, type){
      const first = word?.[0] ? word[0].toUpperCase() : "";
      const kind =
        type === "nomen" ? "Es ist ein Ding/Tier/Name."
        : type === "verb" ? "Es ist eine T√§tigkeit (etwas tun)."
        : type === "adj" ? "Es ist ein Wort f√ºr eine Eigenschaft."
        : "Denk an: Ding / Tun / Eigenschaft.";
      return `Erster Buchstabe: ${first}. ${kind} Versuch es mit Beispielen!`;
    }

    function getHintFor(word){
      if (HINTS[word]) return HINTS[word];
      return simpleFallbackHint(word, currentType);
    }

    function burstConfetti(){
      const colors = ["#A78BFA","#FB7185","#34D399","#60A5FA","#F59E0B","#22C55E","#06B6D4","#F472B6"];
      const n = 42;
      const w = window.innerWidth;

      for (let i = 0; i < n; i++) {
        const c = document.createElement("div");
        c.className = "confetto";
        const x = Math.floor(Math.random() * w);
        const drift2 = (Math.random() * 240 - 120) + (Math.random() * 240 - 120);
        const r = Math.floor(Math.random() * 360);
        const dur = (Math.random() * 0.9 + 0.9).toFixed(2) + "s";

        c.style.left = x + "px";
        c.style.background = colors[Math.floor(Math.random() * colors.length)];
        c.style.setProperty("--x", "0px");
        c.style.setProperty("--x2", drift2 + "px");
        c.style.setProperty("--r", r + "deg");
        c.style.setProperty("--dur", dur);
        c.style.width = (8 + Math.random() * 8).toFixed(0) + "px";
        c.style.height = (10 + Math.random() * 10).toFixed(0) + "px";
        c.style.opacity = (0.75 + Math.random() * 0.25).toFixed(2);

        confettiLayer.appendChild(c);
        c.addEventListener("animationend", () => c.remove());
      }
    }

    /*********************
     *  UI Updates
     *********************/
    function updateTurnUI(){
      if(!started){
        turnBox.style.display = "none";
        return;
      }
      turnBox.style.display = "block";
      const who = (currentPlayer === 1) ? name1 : name2;
      turnNameEl.textContent = who;

      if(twoPlayers && currentPlayer === 2){
        turnBox.style.borderColor = "rgba(34,197,94,.28)";
      } else {
        turnBox.style.borderColor = "rgba(124,58,237,.28)";
      }
    }

    function updateScoreUI(){
      who1.textContent = name1;
      pts1.textContent = `Punkte: ${fmtScore(score1)}`;
      title1.textContent = `Titel: ${titleFor(score1).title}`;

      if(twoPlayers){
        scoreBox2.style.display = "flex";
        who2.textContent = name2;
        pts2.textContent = `Punkte: ${fmtScore(score2)}`;
        title2.textContent = `Titel: ${titleFor(score2).title}`;
      } else {
        scoreBox2.style.display = "none";
      }
    }

    function showHandoff(){
      const who = (currentPlayer === 1) ? name1 : name2;
      handoffNameEl.textContent = who;
      handoffText.textContent = "Dr√ºck dann auf ‚ÄûOK‚Äú.";
      handoff.classList.add("show");
    }
    function hideHandoff(){ handoff.classList.remove("show"); }

    function showHelp(){
      if (!revealed || !currentWord) return;
      usedHelpThisWord = true;
      helpUsedTag.style.display = "inline-block";
      helpTextEl.textContent = getHintFor(currentWord);
      helpOverlay.classList.add("show");
    }
    function hideHelp(){
      helpOverlay.classList.remove("show");
    }

    function showLevelUp(whoName, newTitle){
      levelupBig.textContent = whoName;
      levelupText.textContent = `ist jetzt: ${newTitle}`;
      levelup.classList.add("show");
      burstConfetti();
    }
    function hideLevelUp(){ levelup.classList.remove("show"); }

    /*********************
     *  Game flow
     *********************/
    function resetPerWordState(){
      usedHelpThisWord = false;
      helpUsedTag.style.display = "none";
      helpBtn.disabled = true;
    }

    function nextHiddenWord(){
      const diff = difficultyEl.value;
      currentType = typeEl.value;

      const key = ensureDeck(diff, currentType);
      currentWord = deck[key].arr[deck[key].idx++] || "Keine W√∂rter";
      revealed = false;

      resetPerWordState();

      wordHintEl.textContent = "Wort ist versteckt.";
      wordEl.textContent = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";

      revealBtn.disabled = false;
      rightBtn.disabled = true;
      wrongBtn.disabled = true;
    }

    function revealWord(){
      if(!started) return;
      if(!currentWord) nextHiddenWord();
      if(revealed) return;

      revealed = true;
      wordHintEl.textContent = "Wort:";
      wordEl.textContent = currentWord;

      revealBtn.disabled = true;
      helpBtn.disabled = false;
      rightBtn.disabled = false;
      wrongBtn.disabled = false;
    }

    function applyResult(isCorrect){
      if(!started) return;

      // Punkte-Logik:
      // - richtig: +1 oder (wenn Hilfe genutzt) +0,5
      // - falsch: -1
      const delta = isCorrect ? (usedHelpThisWord ? 0.5 : 1) : -1;

      if(!twoPlayers){
        score1 += delta;
        const t = titleFor(score1);
        updateScoreUI();

        if(t.idx > lastTitleIdx1){
          lastTitleIdx1 = t.idx;
          showLevelUp(name1, t.title);
        }

        nextHiddenWord();
        return;
      }

      if(currentPlayer === 1){
        score1 += delta;
        const t = titleFor(score1);
        updateScoreUI();
        if(t.idx > lastTitleIdx1){
          lastTitleIdx1 = t.idx;
          showLevelUp(name1, t.title);
        }
      } else {
        score2 += delta;
        const t = titleFor(score2);
        updateScoreUI();
        if(t.idx > lastTitleIdx2){
          lastTitleIdx2 = t.idx;
          showLevelUp(name2, t.title);
        }
      }

      // Spielerwechsel
      currentPlayer = (currentPlayer === 1) ? 2 : 1;
      updateTurnUI();

      // Neues Wort vorbereiten (versteckt) + √úbergabe
      nextHiddenWord();
      revealBtn.disabled = true;
      showHandoff();
    }

    function startGame(){
      name1 = (p1nameEl.value || "").trim() || "Spieler 1";
      const raw2 = (p2nameEl.value || "").trim();
      twoPlayers = raw2.length > 0;
      name2 = raw2 || "Spieler 2";

      started = true;
      currentPlayer = 1;

      score1 = 0; score2 = 0;
      lastTitleIdx1 = 0; lastTitleIdx2 = 0;

      // UI lock
      p1nameEl.disabled = true;
      p2nameEl.disabled = true;
      difficultyEl.disabled = true;
      typeEl.disabled = true;
      startBtn.disabled = true;

      updateScoreUI();
      updateTurnUI();

      nextHiddenWord();

      if(twoPlayers){
        revealBtn.disabled = true;
        showHandoff();
      } else {
        revealBtn.disabled = false;
      }
    }

    function resetGame(){
      started = false;
      twoPlayers = false;
      currentPlayer = 1;

      score1 = 0; score2 = 0;
      lastTitleIdx1 = 0; lastTitleIdx2 = 0;

      currentWord = null;
      revealed = false;

      p1nameEl.disabled = false;
      p2nameEl.disabled = false;
      difficultyEl.disabled = false;
      typeEl.disabled = false;
      startBtn.disabled = false;

      hideHandoff();
      hideHelp();
      hideLevelUp();

      updateTurnUI();
      name1 = "Spieler 1"; name2 = "Spieler 2";
      updateScoreUI();

      resetPerWordState();
      wordHintEl.textContent = "Dr√ºck Start üòä";
      wordEl.textContent = "‚Äî";
      revealBtn.disabled = true;
      rightBtn.disabled = true;
      wrongBtn.disabled = true;
    }

    /*********************
     *  Events
     *********************/
    document.addEventListener("DOMContentLoaded", () => {
      startBtn.addEventListener("click", startGame);
      restartBtn.addEventListener("click", resetGame);

      revealBtn.addEventListener("click", revealWord);
      helpBtn.addEventListener("click", showHelp);

      rightBtn.addEventListener("click", () => applyResult(true));
      wrongBtn.addEventListener("click", () => applyResult(false));

      handoffOk.addEventListener("click", () => {
        hideHandoff();
        revealBtn.disabled = false;
      });

      helpOk.addEventListener("click", hideHelp);
      levelupOk.addEventListener("click", hideLevelUp);

      resetGame();
    });
  </script>
</body>
</html>